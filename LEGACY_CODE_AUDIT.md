# üîç –ê–£–î–ò–¢ LEGACY –ö–û–î–ê –ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò –ù–ê PRISMA

**–î–∞—Ç–∞:** 26 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## üìä –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ–ª–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é)

1. **`lib/supabase/` - 4 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–∞**
   - ‚ùå `lib/supabase/client.ts` - –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
   - ‚ùå `lib/supabase/server.ts` - —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
   - ‚ùå `lib/supabase/admin.ts` - admin –∫–ª–∏–µ–Ω—Ç
   - ‚ùå `lib/supabase/public-client.ts` - –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ 170+ —Ñ–∞–π–ª–∞—Ö
   - **–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã –≤—Å–µ—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

2. **`lib/prisma.ts` - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
   - ‚ùå –ö–æ–¥ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã (—Å—Ç—Ä–æ–∫–∏ 1-15 –∏ 18-30)
   - **–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **`package.json` - Supabase –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   ```json
   "@supabase/ssr": "^0.5.1",
   "@supabase/supabase-js": "^2.46.1"
   ```
   - **–ü—Ä–æ–±–ª–µ–º–∞:** –£–≤–µ–ª–∏—á–∏–≤–∞—é—Ç bundle size
   - **–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤

### üü° –°—Ä–µ–¥–Ω–∏–µ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ—á–∏—Å—Ç–∏—Ç—å)

4. **Backup —Ñ–∞–π–ª—ã –≤ `app/api/`**
   - üóëÔ∏è –ú–Ω–æ–∂–µ—Å—Ç–≤–æ `*.supabase-backup`, `*.backup`, `*.final-backup`
   - **–ü—Ä–∏–º–µ—Ä—ã:**
     - `app/api/profiles/route.ts.supabase-backup`
     - `app/api/orders/[id]/route.ts.backup`
   - **–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –≤—Å–µ backup —Ñ–∞–π–ª—ã

5. **–ê–∫—Ç–∏–≤–Ω—ã–µ API routes –Ω–∞ Supabase**
   - ‚úÖ –£–∂–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã: `profiles/public`, `reviews`, `master-class-programs`, `services`, `agency-partners`
   - ‚ùå **–ï—â–µ –Ω–∞ Supabase:**
     - `app/api/upload/route.ts` (–¥–ª—è Storage)
     - `app/api/auth/*` (–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Supabase Auth)
     - –û—Å—Ç–∞–ª—å–Ω—ã–µ API (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

6. **Components —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ Supabase**
   - 170+ —Ñ–∞–π–ª–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç `@/lib/supabase/*`
   - **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:**
     - –§–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π
     - –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
     - –°–µ–∫—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
     - Auth –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã

7. **Pages —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏ Supabase**
   - `app/(public)/profiles/[slug]/page.tsx`
   - `app/(dashboard)/profiles/[slug]/edit/page.tsx`
   - `app/(auth)/login/page.tsx`, `register/page.tsx`
   - Auth —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### üü¢ –ù–∏–∑–∫–∏–µ (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –∫–æ–Ω—Ñ–∏–≥–∏)

8. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Supabase**
   - `docs/SUPABASE_*.md` - —Å—Ç–∞—Ä—ã–µ –≥–∞–π–¥—ã
   - **–†–µ—à–µ–Ω–∏–µ:** –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å

---

## üéØ –ü–õ–ê–ù –ú–ò–ì–†–ê–¶–ò–ò

### –ë–õ–û–ö 1: lib/ - –£—Ç–∏–ª–∏—Ç—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
- [x] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `lib/prisma.ts`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã `@/lib/supabase/*`:
  - `lib/contexts/auth-context.tsx` - –≥–ª–∞–≤–Ω—ã–π Auth –∫–æ–Ω—Ç–µ–∫—Å—Ç
  - `lib/contexts/auth-context-new.tsx` - –Ω–æ–≤—ã–π Auth –∫–æ–Ω—Ç–µ–∫—Å—Ç
  - `lib/hooks/useProfiles.ts`
  - `lib/services/ai-service.ts`
  - `lib/ai/rag.ts`, `generate-profile-embedding.ts`
- [ ] –£–¥–∞–ª–∏—Ç—å `lib/supabase/` –ø–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã

### –ë–õ–û–ö 2: API Routes (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)
- [ ] –ù–∞–π—Ç–∏ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ API —Å Supabase
- [ ] –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ Prisma:
  - `app/api/upload/route.ts` (Storage ‚Üí Yandex Object Storage)
  - `app/api/auth/*` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Supabase Auth)
  - –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ —Å–ø–∏—Å–∫—É
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç

### –ë–õ–û–ö 3: Components (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤:
  - `components/features/profile/create-profile-form.tsx`
  - `components/features/*/` - –º–µ–Ω–µ–¥–∂–µ—Ä—ã –∏ —Ñ–æ—Ä–º—ã
  - `components/providers/favorites-provider.tsx`

### –ë–õ–û–ö 4: Pages (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤:
  - `app/(auth)/login/page.tsx`, `register/page.tsx`
  - `app/(public)/profiles/[slug]/page.tsx`
  - `app/(dashboard)/*` - —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
  - `app/auth/callback/route.ts`

### –ë–õ–û–ö 5: Cleanup (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)
- [ ] –£–¥–∞–ª–∏—Ç—å –≤—Å–µ backup —Ñ–∞–π–ª—ã (`.supabase-backup`, `.backup`)
- [ ] –£–¥–∞–ª–∏—Ç—å Supabase –∏–∑ `package.json`
- [ ] –£–¥–∞–ª–∏—Ç—å/–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Supabase
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—É–±—Ä–∞—Ç—å Supabase keys)

### –ë–õ–û–ö 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ñ–∏–Ω–∞–ª)
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
  - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
  - –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π
  - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
  - API –ø—Ä–æ—Ñ–∏–ª–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å production build

---

## üìà –ü–†–û–ì–†–ï–°–°

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** 15% (5 API –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ ~30)

**–ü–æ –±–ª–æ–∫–∞–º:**
- ‚úÖ –ë–î –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ (100%)
- üü° lib/ —É—Ç–∏–ª–∏—Ç—ã (20%)
- üü° API routes (17%)
- üî¥ Components (5%)
- üî¥ Pages (10%)
- üî¥ Cleanup (0%)

---

## üö® –ö–†–ò–¢–ò–ß–ù–´–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å:**
- `@supabase/supabase-js` - —Ç–æ–ª—å–∫–æ –¥–ª—è Storage (–ø–æ–∫–∞ –Ω–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–º –Ω–∞ Yandex Object Storage)
- –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Storage ‚Üí –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å Supabase

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è Storage:**
1. –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏—Ç—å Storage –Ω–∞ Supabase (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è 152-–§–ó)
2. API –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π (–≥–æ—Ç–æ–≤—ã–π –∫ —Å–º–µ–Ω–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞)
3. –ü–æ—Ç–æ–º –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ Yandex Object Storage

---

## üîß –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –î–õ–Ø –ú–ò–ì–†–ê–¶–ò–ò

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:**
```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã Supabase
grep -r "from '@/lib/supabase" --include="*.ts" --include="*.tsx"

# –ù–∞–π—Ç–∏ createClient
grep -r "createClient" --include="*.ts" --include="*.tsx"

# –ù–∞–π—Ç–∏ backup —Ñ–∞–π–ª—ã
find app/api -name "*.backup" -o -name "*.supabase-backup"
```

**–°–∫—Ä–∏–ø—Ç—ã:**
- `scripts/batch-migrate-apis.mjs` - –º–∞—Å—Å–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è API
- `scripts/auto-migrate-api.mjs` - –∞–≤—Ç–æ-–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ó–ê–í–ï–†–®–ï–ù–ò–Ø

**–ú–∏–≥—Ä–∞—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∫–æ–≥–¥–∞:**
- [ ] –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã `@/lib/supabase/*` —É–¥–∞–ª–µ–Ω—ã
- [ ] `lib/supabase/` –ø–∞–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∞
- [ ] Supabase –ø–∞–∫–µ—Ç—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ `package.json` (–∫—Ä–æ–º–µ Storage)
- [ ] –í—Å–µ backup —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã
- [ ] –õ–∏–Ω—Ç–µ—Ä –ø—Ä–æ—Ö–æ–¥–∏—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Prod build —É—Å–ø–µ—à–Ω—ã–π
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –∑–µ–ª–µ–Ω—ã–µ

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ù–∞—á–∞—Ç—å —Å –ë–õ–û–ö 1 - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ `lib/prisma.ts`




