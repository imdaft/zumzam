# üìä –ò–¢–û–ì–û–í–´–ô –ê–£–î–ò–¢ LEGACY –ö–û–î–ê

**–î–∞—Ç–∞:** 26 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω

---

## üîç –ß–¢–û –û–ë–ù–ê–†–£–ñ–ï–ù–û

### 1. ‚úÖ Prisma —Å—Ö–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π (—Å—Ç—Ä–æ–∫–∏ 1057-1587)
- **–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã, —Å—Ö–µ–º–∞ –≤–∞–ª–∏–¥–Ω–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `npx prisma validate` ‚úÖ

### 2. ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã

**–ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã—Ö –ù–ï–¢ –≤ –ë–î:**

```typescript
// lib/services/ai-service.ts (—Å—Ç—Ä–æ–∫–∞ 120)
await supabase.from('ai_settings').select('*')  // ‚ùå –¢–∞–±–ª–∏—Ü—ã –Ω–µ—Ç!

// lib/ai/get-model-for-task.ts (—Å—Ç—Ä–æ–∫–∞ 52)
await supabase.from('ai_task_models').select('*')  // ‚ùå –¢–∞–±–ª–∏—Ü—ã –Ω–µ—Ç!

// lib/ai/cart-utils.ts (—Å—Ç—Ä–æ–∫–∞ 40)
await supabase.from('cart_items').select('*')  // ‚ùå –¢–∞–±–ª–∏—Ü—ã –Ω–µ—Ç!
```

**–í –ë–î –µ—Å—Ç—å:**
- `cart` (–Ω–æ –Ω–µ `cart_items`)
- –ù–ï–¢ `ai_settings`
- –ù–ï–¢ `ai_task_models`

### 3. üìÅ –§–∞–π–ª—ã —Å Supabase –∏–º–ø–æ—Ä—Ç–∞–º–∏

**lib/** - 8 —Ñ–∞–π–ª–æ–≤:
```
‚úÖ lib/contexts/auth-context.tsx (363 —Å—Ç—Ä–æ–∫–∏) - –û–°–¢–ê–í–ò–¢–¨ (Supabase Auth)
‚úÖ lib/contexts/auth-context-new.tsx (131 —Å—Ç—Ä–æ–∫–∞) - –û–°–¢–ê–í–ò–¢–¨ (Supabase Auth)
‚ùå lib/hooks/useProfiles.ts (317 —Å—Ç—Ä–æ–∫) - –ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ API
‚ùå lib/services/ai-service.ts (1702 —Å—Ç—Ä–æ–∫–∏) - –ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ Prisma
‚ùå lib/ai/rag.ts (177 —Å—Ç—Ä–æ–∫) - –ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ Prisma + pgvector
‚ùå lib/ai/get-model-for-task.ts (212 —Å—Ç—Ä–æ–∫) - –ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ Prisma
‚ùå lib/ai/cart-utils.ts (238 —Å—Ç—Ä–æ–∫) - –ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ Prisma
‚ùå lib/utils/profile-catalog.ts (195 —Å—Ç—Ä–æ–∫) - –ü–ï–†–ï–ü–ò–°–ê–¢–¨ –Ω–∞ Prisma
```

**API routes** - ~25 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Supabase

**Components** - 170+ —Ñ–∞–π–ª–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç `@/lib/supabase/*`

**Pages** - 40+ —Ñ–∞–π–ª–æ–≤

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

**–¶–µ–ª—å:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–¥–∞–∫—à–Ω —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

**–ü–ª–∞–Ω:**
1. ‚úÖ **Auth** - –û–°–¢–ê–í–ò–¢–¨ Supabase Auth (—ç—Ç–æ OK!)
   - `lib/contexts/auth-context.tsx`
   - `lib/contexts/auth-context-new.tsx`
   - `/api/auth/*` callbacks

2. ‚ùå **Database** - –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã:
   - `lib/hooks/useProfiles.ts` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/api/profiles/public` (—É–∂–µ –µ—Å—Ç—å!)
   - `lib/services/ai-service.ts` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
   - `lib/ai/*` ‚Üí –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∏–ª–∏ fallback

3. üü° **–û—Å—Ç–∞–ª—å–Ω–æ–µ** - –û—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø–æ—Ç–æ–º:
   - API routes - —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Supabase (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
   - Components - –∏—Å–ø–æ–ª—å–∑—É—é—Ç API (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

**–í—Ä–µ–º—è:** 4-6 —á–∞—Å–æ–≤

**–†–∏—Å–∫–∏:** –ù–∏–∑–∫–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: **–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**

**–¶–µ–ª—å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞—Ç—å Supabase (–∫—Ä–æ–º–µ Auth)

**–ü–ª–∞–Ω:**
1. –°–æ–∑–¥–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã (`ai_settings`, `ai_task_models`, `cart_items`)
2. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ `lib/` —Ñ–∞–π–ª—ã –Ω–∞ Prisma
3. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ API routes –Ω–∞ Prisma
4. –û–±–Ω–æ–≤–∏—Ç—å Components (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API)
5. Cleanup

**–í—Ä–µ–º—è:** 18-23 —á–∞—Å–∞

**–†–∏—Å–∫–∏:** –°—Ä–µ–¥–Ω–∏–µ (–º–Ω–æ–≥–æ –∫–æ–¥–∞)

---

## ‚úÖ –ß–¢–û –î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°

### –í–∞—Ä–∏–∞–Ω—Ç A: **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```typescript
// 1. lib/hooks/useProfiles.ts - –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ API
export function useProfiles() {
  const [profiles, setProfiles] = useState([])
  const [isLoading, setIsLoading] = useState(true)
  
  useEffect(() => {
    fetch('/api/profiles/public')
      .then(res => res.json())
      .then(data => setProfiles(data))
      .finally(() => setIsLoading(false))
  }, [])
  
  return { profiles, isLoading }
}

// 2. lib/services/ai-service.ts - –¥–æ–±–∞–≤–∏—Ç—å fallback
async getActiveSettings() {
  // Fallback –Ω–∞ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  const apiKey = process.env.GOOGLE_GEMINI_API_KEY
  if (!apiKey) throw new Error('No AI key')
  
  return {
    id: 'fallback',
    provider: 'google',
    model_name: 'gemini-2.0-flash',
    api_key: apiKey,
    is_active: true,
    settings: { temperature: 0.7 }
  }
}

// 3. lib/ai/rag.ts - –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∏–ª–∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å
export async function findRelevantDocs() {
  // TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Prisma + pgvector
  return []
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ –¥–µ–ø–ª–æ–∏—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç B: **–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**

1. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
2. –û–±–Ω–æ–≤–∏—Ç—å Prisma —Å—Ö–µ–º—É
3. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ß–∏—Å—Ç—ã–π –∫–æ–¥, –Ω–æ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê

**–§–∞–π–ª—ã —Å Supabase:**
- `lib/` - 8 —Ñ–∞–π–ª–æ–≤ (6 –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å)
- `app/api/` - ~25 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- `components/` - 170+ —Ñ–∞–π–ª–æ–≤
- `app/` pages - 40+ —Ñ–∞–π–ª–æ–≤

**–û–±—â–∏–π –æ–±—ä–µ–º:**
- ~240 —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Supabase
- ~10,000+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: 4-6 —á–∞—Å–æ–≤
- –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è: 18-23 —á–∞—Å–∞

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì

**–í—ã–±–µ—Ä–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:**

1. **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫** (4-6 —á–∞—Å–æ–≤)
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ–∞–π–ª—ã
   - –î–æ–±–∞–≤–∏—Ç—å fallback'–∏
   - –î–µ–ø–ª–æ–∏—Ç—å

2. **–ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** (18-23 —á–∞—Å–∞)
   - –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
   - –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤–µ—Å—å –∫–æ–¥
   - –ß–∏—Å—Ç—ã–π –ø—Ä–æ–µ–∫—Ç

**–ú–æ–π —Å–æ–≤–µ—Ç:** –ù–∞—á–∞—Ç—å —Å **–ë—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞**, –ø–æ—Ç–æ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω–æ–µ.

---

## üìù –§–ê–ô–õ–´ –°–û–ó–î–ê–ù–´

1. `LEGACY_CODE_AUDIT.md` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç
2. `MIGRATION_STRATEGY.md` - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
3. `AUDIT_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª (—Ä–µ–∑—é–º–µ)

---

**–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –ª—é–±–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π!** üöÄ




