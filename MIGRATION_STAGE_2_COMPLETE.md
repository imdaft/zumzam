# ‚úÖ –≠–¢–ê–ü 2 –ó–ê–í–ï–†–®–Å–ù: –ú–ò–ì–†–ê–¶–ò–Ø –ö–†–ò–¢–ò–ß–ù–´–• API

**–í—Ä–µ–º—è:** 18 –º–∏–Ω—É—Ç  
**–î–∞—Ç–∞:** 25 –¥–µ–∫–∞–±—Ä—è 2025, 22:54 - 23:13

---

## üìä –ú–ò–ì–†–ò–†–û–í–ê–ù–ù–´–ï API (13 endpoints)

### –ì—Ä—É–ø–ø–∞ A: –ü—Ä–æ—Ñ–∏–ª–∏ (3 API)
- ‚úÖ `GET /api/profiles/[id]` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å —Å–≤—è–∑—è–º–∏
- ‚úÖ `PATCH /api/profiles/[id]` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è + activities + services + locations
- ‚úÖ `DELETE /api/profiles/[id]` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

### –ì—Ä—É–ø–ø–∞ B: –û—Ç–∑—ã–≤—ã (5 API)
- ‚úÖ `GET /api/reviews` - —Å–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ (—É–∂–µ –±—ã–ª –Ω–∞ Prisma)
- ‚úÖ `POST /api/reviews` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ `GET /api/reviews/[id]` - –æ–¥–∏–Ω –æ—Ç–∑—ã–≤
- ‚úÖ `PATCH /api/reviews/[id]` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
- ‚úÖ `DELETE /api/reviews/[id]` - —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞

### –ì—Ä—É–ø–ø–∞ C: –£—Å–ª—É–≥–∏ (5 API)
- ‚úÖ `GET /api/services` - —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –ø—Ä–æ—Ñ–∏–ª—è (—É–∂–µ –±—ã–ª –Ω–∞ Prisma)
- ‚úÖ `POST /api/services` - —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
- ‚úÖ `GET /api/services/[id]` - –æ–¥–Ω–∞ —É—Å–ª—É–≥–∞
- ‚úÖ `PATCH /api/services/[id]` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
- ‚úÖ `DELETE /api/services/[id]` - —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏
- ‚úÖ `POST /api/services/reorder` - –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —É—Å–ª—É–≥

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
**–ë—ã–ª–æ:** Supabase Auth (`supabase.auth.getUser()`)  
**–°—Ç–∞–ª–æ:** JWT tokens (`verifyToken(cookie)`)

```typescript
// –ë—ã–ª–æ
const { data: { user }, error } = await supabase.auth.getUser()

// –°—Ç–∞–ª–æ
const token = request.cookies.get('auth-token')?.value
const payload = await verifyToken(token)
const userId = payload.sub
```

### 2. –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î
**–ë—ã–ª–æ:** Supabase Client (PostgREST API)  
**–°—Ç–∞–ª–æ:** Prisma (–ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã)

```typescript
// –ë—ã–ª–æ
const { data, error } = await supabase
  .from('profiles')
  .select('*, profile_locations(*)')
  .eq('id', id)
  .single()

// –°—Ç–∞–ª–æ
const profile = await prisma.profiles.findUnique({
  where: { id },
  include: { profile_locations: true }
})
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
**–ë—ã–ª–æ:** RLS policies –≤ Supabase  
**–°—Ç–∞–ª–æ:** –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ API

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–ª–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º
const profile = await prisma.profiles.findUnique({
  where: { id },
  select: { user_id: true }
})

if (profile.user_id !== userId && !isAdmin) {
  return NextResponse.json({ error: 'Forbidden' }, { status: 403 })
}
```

---

## üìã –û–°–¢–ê–í–®–ò–ï–°–Ø API (–ù–ï –ú–ò–ì–†–ò–†–û–í–ê–ù–´)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–≤–∞–∂–Ω—ã–µ, ~15 API):**
- `/api/requests` - –∑–∞—è–≤–∫–∏
- `/api/show-programs`, `/api/quest-programs`, `/api/animator-characters` - –ø—Ä–æ–≥—Ä–∞–º–º—ã
- `/api/agency-partners` - –ø–∞—Ä—Ç–Ω—ë—Ä—ã –∞–≥–µ–Ω—Ç—Å—Ç–≤
- `/api/profile-locations` - –ª–æ–∫–∞—Ü–∏–∏
- `/api/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ, ~120 API):**
- `/api/analytics/*` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- `/api/notifications/*` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `/api/conversations/*` - —á–∞—Ç—ã
- `/api/admin/*` - –∞–¥–º–∏–Ω–∫–∞
- `/api/ai/*` - AI —Ñ—É–Ω–∫—Ü–∏–∏
- `/api/payments/*` - –ø–ª–∞—Ç–µ–∂–∏
- `/api/telegram/*`, `/api/vk-*` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

1. ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ API (profiles, reviews, services) –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
2. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ JWT
3. ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç Supabase Auth
4. ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ Prisma
5. ‚úÖ –ù–µ—Ç linter –æ—à–∏–±–æ–∫

---

## ‚û°Ô∏è –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

**–≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30-40 –º–∏–Ω)**
1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ API endpoint
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–µ–π

**–≠—Ç–∞–ø 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (10 –º–∏–Ω)**
1. –û–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
2. –°–æ–∑–¥–∞—Ç—å changelog
3. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å migration —Å–∫—Ä–∏–ø—Ç—ã

---

## üìä –û–ë–©–ò–ô –ü–†–û–ì–†–ï–°–° –ú–ò–ì–†–ê–¶–ò–ò

**–≠—Ç–∞–ø 1: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** ‚úÖ (10 –º–∏–Ω)  
**–≠—Ç–∞–ø 2: –ú–∏–≥—Ä–∞—Ü–∏—è API** ‚úÖ (18 –º–∏–Ω)  
**–≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚è≥ (—Å–µ–π—á–∞—Å)  
**–≠—Ç–∞–ø 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚è≥ (–ø–æ—Ç–æ–º)

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 28 –º–∏–Ω—É—Ç  
**–û—Å—Ç–∞–ª–æ—Å—å:** ~40 –º–∏–Ω—É—Ç


**–í—Ä–µ–º—è:** 18 –º–∏–Ω—É—Ç  
**–î–∞—Ç–∞:** 25 –¥–µ–∫–∞–±—Ä—è 2025, 22:54 - 23:13

---

## üìä –ú–ò–ì–†–ò–†–û–í–ê–ù–ù–´–ï API (13 endpoints)

### –ì—Ä—É–ø–ø–∞ A: –ü—Ä–æ—Ñ–∏–ª–∏ (3 API)
- ‚úÖ `GET /api/profiles/[id]` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å —Å–≤—è–∑—è–º–∏
- ‚úÖ `PATCH /api/profiles/[id]` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è + activities + services + locations
- ‚úÖ `DELETE /api/profiles/[id]` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

### –ì—Ä—É–ø–ø–∞ B: –û—Ç–∑—ã–≤—ã (5 API)
- ‚úÖ `GET /api/reviews` - —Å–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ (—É–∂–µ –±—ã–ª –Ω–∞ Prisma)
- ‚úÖ `POST /api/reviews` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø—Ä–æ—Ñ–∏–ª—è
- ‚úÖ `GET /api/reviews/[id]` - –æ–¥–∏–Ω –æ—Ç–∑—ã–≤
- ‚úÖ `PATCH /api/reviews/[id]` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∑—ã–≤–∞
- ‚úÖ `DELETE /api/reviews/[id]` - —É–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞

### –ì—Ä—É–ø–ø–∞ C: –£—Å–ª—É–≥–∏ (5 API)
- ‚úÖ `GET /api/services` - —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ –ø—Ä–æ—Ñ–∏–ª—è (—É–∂–µ –±—ã–ª –Ω–∞ Prisma)
- ‚úÖ `POST /api/services` - —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ª—É–≥–∏ + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞
- ‚úÖ `GET /api/services/[id]` - –æ–¥–Ω–∞ —É—Å–ª—É–≥–∞
- ‚úÖ `PATCH /api/services/[id]` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏
- ‚úÖ `DELETE /api/services/[id]` - —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏
- ‚úÖ `POST /api/services/reorder` - –ø–µ—Ä–µ—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —É—Å–ª—É–≥

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
**–ë—ã–ª–æ:** Supabase Auth (`supabase.auth.getUser()`)  
**–°—Ç–∞–ª–æ:** JWT tokens (`verifyToken(cookie)`)

```typescript
// –ë—ã–ª–æ
const { data: { user }, error } = await supabase.auth.getUser()

// –°—Ç–∞–ª–æ
const token = request.cookies.get('auth-token')?.value
const payload = await verifyToken(token)
const userId = payload.sub
```

### 2. –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î
**–ë—ã–ª–æ:** Supabase Client (PostgREST API)  
**–°—Ç–∞–ª–æ:** Prisma (–ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã)

```typescript
// –ë—ã–ª–æ
const { data, error } = await supabase
  .from('profiles')
  .select('*, profile_locations(*)')
  .eq('id', id)
  .single()

// –°—Ç–∞–ª–æ
const profile = await prisma.profiles.findUnique({
  where: { id },
  include: { profile_locations: true }
})
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
**–ë—ã–ª–æ:** RLS policies –≤ Supabase  
**–°—Ç–∞–ª–æ:** –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ API

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–ª–∞–¥–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–º
const profile = await prisma.profiles.findUnique({
  where: { id },
  select: { user_id: true }
})

if (profile.user_id !== userId && !isAdmin) {
  return NextResponse.json({ error: 'Forbidden' }, { status: 403 })
}
```

---

## üìã –û–°–¢–ê–í–®–ò–ï–°–Ø API (–ù–ï –ú–ò–ì–†–ò–†–û–í–ê–ù–´)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–≤–∞–∂–Ω—ã–µ, ~15 API):**
- `/api/requests` - –∑–∞—è–≤–∫–∏
- `/api/show-programs`, `/api/quest-programs`, `/api/animator-characters` - –ø—Ä–æ–≥—Ä–∞–º–º—ã
- `/api/agency-partners` - –ø–∞—Ä—Ç–Ω—ë—Ä—ã –∞–≥–µ–Ω—Ç—Å—Ç–≤
- `/api/profile-locations` - –ª–æ–∫–∞—Ü–∏–∏
- `/api/upload` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ, ~120 API):**
- `/api/analytics/*` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- `/api/notifications/*` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `/api/conversations/*` - —á–∞—Ç—ã
- `/api/admin/*` - –∞–¥–º–∏–Ω–∫–∞
- `/api/ai/*` - AI —Ñ—É–Ω–∫—Ü–∏–∏
- `/api/payments/*` - –ø–ª–∞—Ç–µ–∂–∏
- `/api/telegram/*`, `/api/vk-*` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

1. ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ API (profiles, reviews, services) –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
2. ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ JWT
3. ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç Supabase Auth
4. ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ Prisma
5. ‚úÖ –ù–µ—Ç linter –æ—à–∏–±–æ–∫

---

## ‚û°Ô∏è –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

**–≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30-40 –º–∏–Ω)**
1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ API endpoint
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–µ–π

**–≠—Ç–∞–ø 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (10 –º–∏–Ω)**
1. –û–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
2. –°–æ–∑–¥–∞—Ç—å changelog
3. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å migration —Å–∫—Ä–∏–ø—Ç—ã

---

## üìä –û–ë–©–ò–ô –ü–†–û–ì–†–ï–°–° –ú–ò–ì–†–ê–¶–ò–ò

**–≠—Ç–∞–ø 1: –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** ‚úÖ (10 –º–∏–Ω)  
**–≠—Ç–∞–ø 2: –ú–∏–≥—Ä–∞—Ü–∏—è API** ‚úÖ (18 –º–∏–Ω)  
**–≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚è≥ (—Å–µ–π—á–∞—Å)  
**–≠—Ç–∞–ø 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚è≥ (–ø–æ—Ç–æ–º)

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 28 –º–∏–Ω—É—Ç  
**–û—Å—Ç–∞–ª–æ—Å—å:** ~40 –º–∏–Ω—É—Ç




