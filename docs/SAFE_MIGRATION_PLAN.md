# üõ°Ô∏è –ü–õ–ê–ù –ë–ï–ó–û–ü–ê–°–ù–û–ô –ú–ò–ì–†–ê–¶–ò–ò –ù–ê –ù–û–í–£–Æ –°–ò–°–¢–ï–ú–£ –ü–†–û–§–ò–õ–ï–ô

**–î–∞—Ç–∞:** 20 –¥–µ–∫–∞–±—Ä—è 2025  
**–¶–µ–ª—å:** –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –Ω–æ–≤—É—é –º–Ω–æ–≥–æ–º–µ—Ä–Ω—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –±–µ–∑ –ø–æ–ª–æ–º–æ–∫  
**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –ß—Ç–æ –£–ñ–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞):
- `category` ‚Üí —Å—Ç–∞—Ä–æ–µ –ø–ª–æ—Å–∫–æ–µ –ø–æ–ª–µ (animator, venue, show, etc.)
- `details.venue_type` ‚Üí —Å—Ç–∞—Ä–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–ª–æ—â–∞–¥–æ–∫
- `CategoryVisualSelector` ‚Üí –≤—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–®–ê–ì 1)
- `VenueTypeGroupedSelector` ‚Üí –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–ª–æ—â–∞–¥–∫–∏ (–®–ê–ì 2)
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ‚Üí —Ä–µ–Ω–¥–µ—Ä–∏—Ç –ø–æ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º
- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Üí —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º
- ~30+ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ –ë–î

### ‚úÖ –ß—Ç–æ –£–ñ–ï —Å–æ–∑–¥–∞–Ω–æ (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞):
- ‚úÖ –ë–î: `primary_venue_type`, `activities`, `business_models`, `space_type`, `additional_services`
- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥–∏: `activity_catalog`, `service_catalog`
- ‚úÖ `ClassificationWizard` (5 —à–∞–≥–æ–≤) - **–ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω**
- ‚úÖ `generateProfileBlocks()` - **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**
- ‚úÖ –ù–æ–≤—ã–µ –±–ª–æ–∫–∏ (Activities, Pricing, etc.) - **–ù–ï —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è**
- ‚úÖ 10 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –ø–æ–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:** –í–∏–∑–∞—Ä–¥ —Å–æ–∑–¥–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- **–†–∏—Å–∫:** –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ —Å–ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏

---

## üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –ú–ò–ì–†–ê–¶–ò–ò

### –ü—Ä–∏–Ω—Ü–∏–ø—ã:
1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ—Å—Ç—å:** –®–∞–≥ –∑–∞ —à–∞–≥–æ–º, —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ
2. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –°—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ú–∏–≥—Ä–∞—Ü–∏—è ‚Üí –£–¥–∞–ª–µ–Ω–∏–µ:** –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –≠—Ç–∞–ø—ã:
```
–≠–¢–ê–ü 1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∏–∑–∞—Ä–¥–∞ (–Ω–æ–≤–æ–µ + —Å—Ç–∞—Ä–æ–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
‚Üì
–≠–¢–ê–ü 2: –î–≤–æ–π–Ω–∞—è –∑–∞–ø–∏—Å—å (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞)
‚Üì
–≠–¢–ê–ü 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è (—á–∏—Ç–∞–µ–º –∏–∑ –Ω–æ–≤–æ–≥–æ, fallback –Ω–∞ —Å—Ç–∞—Ä–æ–µ)
‚Üì
–≠–¢–ê–ü 4: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø–µ—Ä–µ–Ω–æ—Å–∏–º —Å—Ç–∞—Ä—ã–µ ‚Üí –Ω–æ–≤—ã–µ –ø–æ–ª—è)
‚Üì
–≠–¢–ê–ü 5: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤–æ–µ)
‚Üì
–≠–¢–ê–ü 6: –û—á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–¥)
```

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù (6 –≠–¢–ê–ü–û–í)

---

## üîß –≠–¢–ê–ü 1: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í–ò–ó–ê–†–î–ê (1-2 —á–∞—Å–∞)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑–∞—Ä–¥ –≤ —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –ù–ï —Ç—Ä–æ–≥–∞—è —Å—Ç–∞—Ä—ã–π –∫–æ–¥

### –®–ê–ì 1.1: –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑–∞—Ä–¥ –≤ CreateProfileForm
**–§–∞–π–ª:** `components/features/profile/create-profile-form.tsx`

```tsx
// –î–û–ë–ê–í–ò–¢–¨ –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é –î–û —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö CategoryVisualSelector
<Card id="section-classification">
  <CardHeader>
    <CardTitle>üéØ –ù–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (–±–µ—Ç–∞)</CardTitle>
    <CardDescription>
      –û–ø—Ä–æ–±—É–π—Ç–µ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É. –°—Ç–∞—Ä–∞—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–∏–∂–µ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
    </CardDescription>
  </CardHeader>
  <CardContent>
    <ClassificationWizard
      profileId={profileId}
      initialData={{
        primary_venue_type: initialData?.primary_venue_type,
        activities: initialData?.activities || [],
        business_models: initialData?.business_models || [],
        space_type: initialData?.space_type,
        additional_services: initialData?.additional_services || [],
      }}
      onComplete={(data) => {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –Ω–æ–≤—ã–µ –ø–æ–ª—è
        form.setValue('primary_venue_type', data.primary_venue_type)
        form.setValue('activities', data.activities)
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
      }}
    />
  </CardContent>
</Card>

<Separator className="my-8" />

{/* –°–¢–ê–†–ê–Ø –°–ò–°–¢–ï–ú–ê (–≤—Ä–µ–º–µ–Ω–Ω–æ, –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) */}
<div className="opacity-60">
  <p className="text-sm text-muted-foreground mb-4">
    ‚ö†Ô∏è –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ (—Å–∫–æ—Ä–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞):
  </p>
  <CategoryVisualSelector ... />
  <VenueTypeGroupedSelector ... />
</div>
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –û–ë–ï —Å–∏—Å—Ç–µ–º—ã, –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–æ–≤—É—é

---

### –®–ê–ì 1.2: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
**–§–∞–π–ª:** `lib/validations/profile.ts`

```typescript
export const profileSchema = z.object({
  // –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
  category: z.string(),
  
  // –ù–æ–≤—ã–µ –ø–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–º —ç—Ç–∞–ø–µ)
  primary_venue_type: z.enum([...]).optional(),
  activities: z.array(z.string()).optional(),
  business_models: z.array(z.enum([...])).optional(),
  space_type: z.enum([...]).optional(),
  additional_services: z.array(z.string()).optional(),
  
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ —Å—Ç–∞—Ä—ã–µ, –∏ –Ω–æ–≤—ã–µ –ø–æ–ª—è

---

### –®–ê–ì 1.3: –î–≤–æ–π–Ω–∞—è –∑–∞–ø–∏—Å—å –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
**–§–∞–π–ª:** `app/api/profiles/[id]/route.ts`

```typescript
// PATCH /api/profiles/[id]
export async function PATCH(req: Request) {
  const data = await req.json()
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö
  const updateData: any = { ...data }
  
  // –î–í–û–ô–ù–ê–Ø –ó–ê–ü–ò–°–¨: –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –∫–æ–ø–∏—Ä—É–µ–º –≤ —Å—Ç–∞—Ä—É—é
  if (data.primary_venue_type) {
    // –ú–∞–ø–ø–∏–Ω–≥: –Ω–æ–≤–æ–µ ‚Üí —Å—Ç–∞—Ä–æ–µ (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    updateData.category = mapPrimaryTypeToCategory(data.primary_venue_type)
    if (data.primary_venue_type === 'active_entertainment' || ...) {
      updateData.details = {
        ...updateData.details,
        venue_type: mapToOldVenueType(data.primary_venue_type, data.space_type)
      }
    }
  }
  
  await supabase.from('profiles').update(updateData).eq('id', profileId)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—è ‚Üí —Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –®–ê–ì 1.4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û—Ç–∫—Ä—ã—Ç—å `/profiles/kidspoint/edit`
- [ ] –£–≤–∏–¥–µ—Ç—å –≤–∏–∑–∞—Ä–¥ –≤–≤–µ—Ä—Ö—É + —Å—Ç–∞—Ä—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤–Ω–∏–∑—É
- [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å –≤–∏–∑–∞—Ä–¥
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ **–æ–±–∞** –Ω–∞–±–æ—Ä–∞ –ø–æ–ª–µ–π –∑–∞–ø–æ–ª–Ω–∏–ª–∏—Å—å –≤ –ë–î
- [ ] –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø—É–±–ª–∏—á–Ω–æ ‚Üí –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞  
**–†–∏—Å–∫:** üü¢ –ù–∏–∑–∫–∏–π (–Ω–µ —Ç—Ä–æ–≥–∞–µ–º —Å—Ç–∞—Ä—ã–π –∫–æ–¥)

---

## üîÑ –≠–¢–ê–ü 2: –û–ë–ù–û–í–õ–ï–ù–ò–ï –†–ï–ù–î–ï–†–ò–ù–ì–ê (2-3 —á–∞—Å–∞)

**–¶–µ–ª—å:** –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Ñ–∏–ª—è —á–∏—Ç–∞–µ—Ç –∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π, fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ

### –®–ê–ì 2.1: –û–±–Ω–æ–≤–∏—Ç—å `app/(public)/profiles/[slug]/page.tsx`
**–§–∞–π–ª:** `app/(public)/profiles/[slug]/page.tsx`

```tsx
import { generateProfileBlocks } from '@/lib/profile-blocks/generator'

export default async function ProfilePage({ params }: PageProps) {
  const profile = await fetchProfile(params.slug)
  
  // –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê: –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–ª–æ–∫–∏
  if (profile.primary_venue_type || profile.activities?.length > 0) {
    const blocks = generateProfileBlocks(profile)
    
    return (
      <div>
        <ProfileHeader profile={profile} />
        
        {blocks.map(block => {
          switch (block.type) {
            case 'activities':
              return <ActivitiesBlock key={block.id} {...block.data} />
            case 'ticket_pricing':
              return <TicketPricingBlock key={block.id} {...block.data} />
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
          }
        })}
      </div>
    )
  }
  
  // –°–¢–ê–†–ê–Ø –°–ò–°–¢–ï–ú–ê (fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π)
  return (
    <div>
      {/* –¢–µ–∫—É—â–∏–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø–æ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º */}
      {profile.category === 'venue' && (
        <LocationsTabs locations={profile.profile_locations} />
      )}
      // ... —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞
    </div>
  )
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 
- –ù–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ ‚Üí –∫—Ä–∞—Å–∏–≤—ã–π –º–æ–¥—É–ª—å–Ω—ã–π –≤–∏–¥
- –°—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ ‚Üí —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

---

### –®–ê–ì 2.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û—Ç–∫—Ä—ã—Ç—å `/profiles/mazapark-spb` (–Ω–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π) ‚Üí –Ω–æ–≤—ã–π –≤–∏–¥
- [ ] –û—Ç–∫—Ä—ã—Ç—å `/profiles/kidspoint` (—Å—Ç–∞—Ä—ã–π) ‚Üí —Å—Ç–∞—Ä—ã–π –≤–∏–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é (85% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç–∏–ø—ã –±–ª–æ–∫–æ–≤

**–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞  
**–†–∏—Å–∫:** üü° –°—Ä–µ–¥–Ω–∏–π (–º–µ–Ω—è–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥, –Ω–æ —Å fallback)

---

## üîÄ –≠–¢–ê–ü 3: –ú–ò–ì–†–ê–¶–ò–Ø –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –î–ê–ù–ù–´–• (1-2 —á–∞—Å–∞)

**–¶–µ–ª—å:** –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç

### –®–ê–ì 3.1: –°–æ–∑–¥–∞—Ç—å SQL —Ñ—É–Ω–∫—Ü–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏
**–§–∞–π–ª:** `supabase/migrations/YYYYMMDD_migrate_old_profiles.sql`

```sql
-- –§—É–Ω–∫—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ category + venue_type ‚Üí –Ω–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
CREATE OR REPLACE FUNCTION migrate_profile_to_new_classification(
  p_profile_id UUID
) RETURNS VOID AS $$
DECLARE
  v_category TEXT;
  v_venue_type TEXT;
BEGIN
  SELECT category, details->>'venue_type' 
  INTO v_category, v_venue_type
  FROM profiles 
  WHERE id = p_profile_id;
  
  -- –ú–∞–ø–ø–∏–Ω–≥ category ‚Üí primary_venue_type
  UPDATE profiles SET
    primary_venue_type = CASE
      WHEN v_category = 'venue' AND v_venue_type = 'event_studio' THEN 'event_space'
      WHEN v_category = 'venue' AND v_venue_type = 'entertainment_center' THEN 'active_entertainment'
      WHEN v_category = 'animator' THEN NULL -- –ê–Ω–∏–º–∞—Ç–æ—Ä—ã –Ω–µ area-based
      -- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∞–ø–ø–∏–Ω–≥–∏
    END,
    
    activities = CASE
      WHEN v_venue_type = 'entertainment_center' THEN ARRAY['arcade', 'active_games']::TEXT[]
      WHEN v_category = 'animator' THEN ARRAY['character_animation']::TEXT[]
      -- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
    END,
    
    business_models = CASE
      WHEN v_category = 'venue' AND (details->>'has_packages')::BOOLEAN THEN ARRAY['packages_turnkey']::business_model_enum[]
      WHEN v_category = 'venue' THEN ARRAY['rental']::business_model_enum[]
      WHEN v_category = 'animator' THEN ARRAY['mobile_service']::business_model_enum[]
      -- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
    END,
    
    space_type = CASE
      WHEN v_venue_type = 'event_studio' THEN 'dedicated_venue'
      WHEN v_venue_type = 'entertainment_center' THEN 'mall_venue'
      -- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
    END
    
  WHERE id = p_profile_id;
  
  -- –û–±–Ω–æ–≤–ª—è–µ–º search_vector (—Ç—Ä–∏–≥–≥–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
END;
$$ LANGUAGE plpgsql;

-- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –í–°–ï –ø—Ä–æ—Ñ–∏–ª–∏
DO $$
DECLARE
  profile_record RECORD;
BEGIN
  FOR profile_record IN 
    SELECT id FROM profiles WHERE primary_venue_type IS NULL
  LOOP
    PERFORM migrate_profile_to_new_classification(profile_record.id);
  END LOOP;
END $$;
```

---

### –®–ê–ì 3.2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
```bash
# –ß–µ—Ä–µ–∑ Supabase MCP
apply_migration(
  name="migrate_old_profiles_to_new_classification",
  query="..." # SQL –≤—ã—à–µ
)
```

---

### –®–ê–ì 3.3: –ü—Ä–æ–≤–µ—Ä–∫–∞
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏
SELECT 
  id, 
  display_name,
  category AS old_category,
  primary_venue_type AS new_type,
  activities,
  business_models
FROM profiles
WHERE created_at < '2025-12-20' -- –°—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
ORDER BY created_at;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞  
**–†–∏—Å–∫:** üü° –°—Ä–µ–¥–Ω–∏–π (–º–µ–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ, –Ω–æ —á–∏—Ç–∞–µ–º –∏–∑ –æ–±–æ–∏—Ö –ø–æ–ª–µ–π)

---

## üéØ –≠–¢–ê–ü 4: –û–ë–ù–û–í–õ–ï–ù–ò–ï –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ (1-2 —á–∞—Å–∞)

**–¶–µ–ª—å:** –§–∏–ª—å—Ç—Ä—ã –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–æ–≤—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é

### –®–ê–ì 4.1: –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
**–§–∞–π–ª:** `app/(public)/page.tsx`

```tsx
// –í–º–µ—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ category
<FilterSelect
  label="–¢–∏–ø –ø–ª–æ—â–∞–¥–∫–∏"
  options={[
    { value: 'active_entertainment', label: '–ê–∫—Ç–∏–≤–Ω—ã–µ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è' },
    { value: 'creative_space', label: '–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –º–∞—Å—Ç–µ—Ä—Å–∫–∏–µ' },
    // ... –∏–∑ primary_venue_type_enum
  ]}
  value={filters.primary_venue_type}
  onChange={(value) => setFilters({ ...filters, primary_venue_type: value })}
/>

<FilterSelect
  label="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
  options={activityCatalog} // –ò–∑ –ë–î
  multiple
  value={filters.activities}
  onChange={(value) => setFilters({ ...filters, activities: value })}
/>
```

---

### –®–ê–ì 4.2: –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π
**–§–∞–π–ª:** `components/features/profile/profile-card.tsx`

```tsx
export function ProfileCard({ profile }: { profile: Profile }) {
  // –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  const displayActivities = profile.activities?.slice(0, 3) || []
  
  return (
    <div>
      {/* –¢–µ–≥–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ venueType */}
      <div className="flex flex-wrap gap-1">
        {displayActivities.map(activity => (
          <Badge key={activity}>
            {getActivityLabel(activity)}
          </Badge>
        ))}
      </div>
      
      {/* –ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å */}
      {profile.business_models?.includes('tickets_freeplay') && (
        <Badge variant="outline">–í—Ö–æ–¥–Ω—ã–µ –±–∏–ª–µ—Ç—ã</Badge>
      )}
    </div>
  )
}
```

---

### –®–ê–ì 4.3: –û–±–Ω–æ–≤–∏—Ç—å API `/api/profiles/public`
**–§–∞–π–ª:** `app/api/profiles/public/route.ts`

```typescript
export async function GET(req: Request) {
  const { searchParams } = new URL(req.url)
  const primary_venue_type = searchParams.get('primary_venue_type')
  const activities = searchParams.getAll('activities')
  
  let query = supabase
    .from('profiles')
    .select('*')
    .eq('is_published', true)
  
  // –§–∏–ª—å—Ç—Ä –ø–æ –Ω–æ–≤—ã–º –ø–æ–ª—è–º
  if (primary_venue_type) {
    query = query.eq('primary_venue_type', primary_venue_type)
  }
  
  if (activities.length > 0) {
    query = query.contains('activities', activities)
  }
  
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
}
```

**–í—Ä–µ–º—è:** 1-2 —á–∞—Å–∞  
**–†–∏—Å–∫:** üü¢ –ù–∏–∑–∫–∏–π (UI –∏–∑–º–µ–Ω–µ–Ω–∏—è)

---

## üßπ –≠–¢–ê–ü 5: –û–ß–ò–°–¢–ö–ê –°–¢–ê–†–û–ì–û –ö–û–î–ê (1 —á–∞—Å)

**–¶–µ–ª—å:** –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥

### –®–ê–ì 5.1: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```bash
# –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã
‚ùå components/features/profile/category-visual-selector.tsx
‚ùå components/features/profile/venue-type-grouped-selector.tsx
‚ùå components/features/profile/category-selection-step.tsx
```

---

### –®–ê–ì 5.2: –£–¥–∞–ª–∏—Ç—å –∏–∑ CreateProfileForm
**–§–∞–π–ª:** `components/features/profile/create-profile-form.tsx`

```tsx
// –£–î–ê–õ–ò–¢–¨ –∏–º–ø–æ—Ä—Ç—ã
- import { CategoryVisualSelector } from './category-visual-selector'
- import { VenueTypeGroupedSelector } from './venue-type-grouped-selector'

// –£–î–ê–õ–ò–¢–¨ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç–∞—Ä—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
- <CategoryVisualSelector ... />
- <VenueTypeGroupedSelector ... />

// –£–î–ê–õ–ò–¢–¨ —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –ø–æ —Å—Ç–∞—Ä—ã–º –ø–æ–ª—è–º
- if (category === 'venue') { ... }
```

---

### –®–ê–ì 5.3: –°–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏
**–§–∞–π–ª:** `lib/validations/profile.ts`

```typescript
export const profileSchema = z.object({
  // –°—Ç–∞—Ä—ã–µ –ø–æ–ª—è —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)
  category: z.string().optional(),
  
  // –ù–æ–≤—ã–µ –ø–æ–ª—è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´
  primary_venue_type: z.enum([...]).nullable(), // null –¥–ª—è –≤—ã–µ–∑–¥–Ω—ã—Ö
  activities: z.array(z.string()).min(1, '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã 1 –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'),
  business_models: z.array(z.enum([...])).min(1, '–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å'),
  // ...
})
```

---

### –®–ê–ì 5.4: –£–¥–∞–ª–∏—Ç—å fallback –≤ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ
**–§–∞–π–ª:** `app/(public)/profiles/[slug]/page.tsx`

```tsx
// –£–î–ê–õ–ò–¢–¨ —Å—Ç–∞—Ä—É—é –≤–µ—Ç–∫—É
- if (profile.primary_venue_type || profile.activities?.length > 0) {
-   // –Ω–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- } else {
-   // –£–î–ê–õ–ò–¢–¨ –≠–¢–û ‚Üì
-   // —Å—Ç–∞—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- }

// –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:
const blocks = generateProfileBlocks(profile)
return <ProfileView blocks={blocks} />
```

**–í—Ä–µ–º—è:** 1 —á–∞—Å  
**–†–∏—Å–∫:** üü¢ –ù–∏–∑–∫–∏–π (–≤—Å–µ —É–∂–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ)

---

## ‚úÖ –≠–¢–ê–ü 6: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê (30 –º–∏–Ω)

### –ß–µ–∫-–ª–∏—Å—Ç:
- [ ] –í—Å–µ —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ù–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –≤–∏–∑–∞—Ä–¥
- [ ] –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –Ω–æ–≤—ã–º –ø–æ–ª—è–º
- [ ] –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (search_vector –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è)
- [ ] –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [ ] –ù–µ—Ç SQL –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Supabase

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –†–∏—Å–∫ | –û—Ç–∫–∞—Ç |
|------|-------|------|-------|
| 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–∏–∑–∞—Ä–¥–∞ | 1-2—á | üü¢ –ù–∏–∑–∫–∏–π | –°–∫—Ä—ã—Ç—å –≤–∏–∑–∞—Ä–¥ |
| 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ | 2-3—á | üü° –°—Ä–µ–¥–Ω–∏–π | –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä |
| 3. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö | 1-2—á | üü° –°—Ä–µ–¥–Ω–∏–π | SQL rollback |
| 4. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ | 1-2—á | üü¢ –ù–∏–∑–∫–∏–π | –û—Ç–∫–∞—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ |
| 5. –û—á–∏—Å—Ç–∫–∞ | 1—á | üü¢ –ù–∏–∑–∫–∏–π | Git revert |
| 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ | 30–º–∏–Ω | - | - |
| **–ò–¢–û–ì–û** | **7-11—á** | | |

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì

**–ù–∞—á–∏–Ω–∞–µ–º —Å –≠–¢–ê–ü 1, –®–ê–ì 1.1:**
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å `ClassificationWizard` –≤ `CreateProfileForm`

**–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å?** üöÄ





