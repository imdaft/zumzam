# –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è

## –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. **–ù–µ —Ç—Ä–µ–±—É–µ—Ç Supabase** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Prisma.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
**–ü—É—Ç—å:** `/forgot-password`  
**–§–∞–π–ª:** `app/(auth)/forgot-password/page.tsx`

- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ email
- –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod schema
- –ü–æ–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- –°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

### 2. API —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
**Endpoint:** `POST /api/auth/forgot-password`  
**–§–∞–π–ª:** `app/api/auth/forgot-password/route.ts`

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ç–æ–∫–µ–Ω (crypto.randomBytes)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü—É `password_reset_tokens`
- –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ email (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- –í DEV: –ª–æ–≥–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å
- –í PROD: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email (TODO)

### 3. –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è
**–ü—É—Ç—å:** `/reset-password`  
**–§–∞–π–ª:** `app/(auth)/reset-password/page.tsx`

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞

### 4. API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
**Endpoint:** `POST /api/auth/reset-password`  
**–§–∞–π–ª:** `app/api/auth/reset-password/route.ts`

- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ `password_reset_tokens`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (1 —á–∞—Å)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ —Ç–æ–∫–µ–Ω
- –•–µ—à–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ bcrypt
- –û–±–Ω–æ–≤–ª—è–µ—Ç `password_hash` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –ü–æ–º–µ—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π

## Flow –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /forgot-password
2. –í–≤–æ–¥–∏—Ç email ‚Üí POST /api/auth/forgot-password
3. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–∫–µ–Ω –≤ –ë–î –∏ –ª–æ–≥–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –≤ –∫–æ–Ω—Å–æ–ª—å (DEV)
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí /reset-password?token=xxx
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å ‚Üí POST /api/auth/reset-password
6. –¢–æ–∫–µ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –ø–∞—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
7. –¢–æ–∫–µ–Ω –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π
8. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login?password_reset=true
```

## –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–ª—è —Å—Å—ã–ª–æ–∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è)
NEXT_PUBLIC_APP_URL="http://localhost:4000"

# –í production –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email
# –ù–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ Resend, SendGrid, –∏–ª–∏ SMTP
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–¢–∞–±–ª–∏—Ü–∞:** `password_reset_tokens`

```sql
- id: UUID (PK)
- user_id: UUID (FK ‚Üí users)
- token: TEXT (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- expires_at: TIMESTAMPTZ (—á–µ—Ä–µ–∑ 1 —á–∞—Å)
- used_at: TIMESTAMPTZ (null –¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- created_at: TIMESTAMPTZ
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_password_reset_tokens_token` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ç–æ–∫–µ–Ω—É
- `idx_password_reset_tokens_expires_at` - –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ email** - –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—Ö
2. **–¢–æ–∫–µ–Ω –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π** - –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏** - —Å—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç 1 —á–∞—Å
4. **Bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∏–¥–µ —Ö–µ—à–∞
5. **–í—ã—Ö–æ–¥ –∏–∑ —Å–µ—Å—Å–∏–∏** - –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è —Å–µ—Å—Å–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

- **–ù–µ —Ç—Ä–µ–±—É–µ—Ç Supabase** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Prisma
- –•—Ä–∞–Ω–∏—Ç `password_hash` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –¢–æ–∫–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `password_reset_tokens`
- –°–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å OAuth (–Ø–Ω–¥–µ–∫—Å ID)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI
- –í DEV –ª–æ–≥–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/login`
2. –ö–ª–∏–∫–Ω—É—Ç—å "–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?"
3. –í–≤–µ—Å—Ç–∏ email
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞** - —Ç–∞–º –±—É–¥–µ—Ç —Å—Å—ã–ª–∫–∞
5. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
6. –í–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å
7. –í–æ–π—Ç–∏ —Å –Ω–æ–≤—ã–º –ø–∞—Ä–æ–ª–µ–º

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å:**
```
================================================================================
üîë –°–°–´–õ–ö–ê –î–õ–Ø –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø –ü–ê–†–û–õ–Ø
================================================================================
Email: user@example.com
–°—Å—ã–ª–∫–∞: http://localhost:4000/reset-password?token=abc123...
–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: 27.12.2025, 05:00:00
================================================================================
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `NEXT_PUBLIC_SUPABASE_URL` –∏ `SUPABASE_SERVICE_ROLE_KEY`

### "–°—Å—ã–ª–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª–∞"
- –°—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç 1 —á–∞—Å
- –°—Å—ã–ª–∫–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è
- –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É

### –°—Å—ã–ª–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ - —Ç–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Å—ã–ª–∫–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç—ë–∫ (1 —á–∞—Å)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- –í production –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É email

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email** (Resend, SendGrid, SMTP)
- [ ] Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–∞–º–∞
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ (cron)
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞ email –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è
- [ ] 2FA –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è
- [ ] –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–∞—Ä–æ–ª—è
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

