# ๐ AI Function Calling - ะะฐะฑะพัะฐ ั ะบะพัะทะธะฝะพะน

## ะะฑะทะพั

AI-ะฐััะธััะตะฝั ZumZam ัะตะฟะตัั ะผะพะถะตั ะฝะฐะฟััะผัั ะฒะทะฐะธะผะพะดะตะนััะฒะพะฒะฐัั ั ะบะพัะทะธะฝะพะน ะฟะพะปัะทะพะฒะฐัะตะปั ัะตัะตะท **Gemini Function Calling**. ะญัะพ ะฟะพะทะฒะพะปัะตั ะดะพะฑะฐะฒะปััั/ัะดะฐะปััั ััะปัะณะธ ะณะพะปะพัะพะผ ะธะปะธ ัะตะบััะพะผ, ะฝะต ะฟะพะบะธะดะฐั ัะฐั.

---

## ๐ฏ ะะพะทะผะพะถะฝะพััะธ

### 1. ะะพะฑะฐะฒะปะตะฝะธะต ััะปัะณ ะฒ ะบะพัะทะธะฝั
```
๐ค "ะะพะฑะฐะฒั KidsPoint ะฒ ะบะพัะทะธะฝั"
๐ค โ ะะพะฑะฐะฒะปะตะฝะพ ะฒ ะบะพัะทะธะฝั: "ะะตะฝั ัะพะถะดะตะฝะธั" ะพั KidsPoint

๐ค "ะฅะพัั ะฟะฐะบะตั ะัะตะผะธัะผ ะพั ััะพะน ัััะดะธะธ"
๐ค โ ะะพะฑะฐะฒะปะตะฝะพ: ะะฐะบะตั "ะัะตะผะธัะผ" (30,000โฝ) - 3 ัะฐัะฐ, ะดะพ 20 ะดะตัะตะน
```

### 2. ะฃะดะฐะปะตะฝะธะต ะธะท ะบะพัะทะธะฝั
```
๐ค "ะฃะดะฐะปะธ KidsPoint"
๐ค ๐๏ธ ะฃะดะฐะปะตะฝะพ ะธะท ะบะพัะทะธะฝั: "ะะตะฝั ัะพะถะดะตะฝะธั"

๐ค "ะฃะฑะตัะธ ะฟะพัะปะตะดะฝัั ะดะพะฑะฐะฒะปะตะฝะฝัั ััะปัะณั"
๐ค ๐๏ธ ะฃะดะฐะปะตะฝะพ ะธะท ะบะพัะทะธะฝั: "ะะฐััะตั-ะบะปะฐัั ะฟะพ ัะธัะพะฒะฐะฝะธั"
```

### 3. ะัะพัะผะพัั ะบะพัะทะธะฝั
```
๐ค "ะงัะพ ั ะผะตะฝั ะฒ ะบะพัะทะธะฝะต?"
๐ค ๐ ะ ะบะพัะทะธะฝะต 2 ััะปัะณะธ ะฝะฐ ััะผะผั 50,000โฝ:
   1. ะะตะฝั ัะพะถะดะตะฝะธั (KidsPoint) - 20,000โฝ
   2. ะะฐะบะตั ะัะตะผะธัะผ (ArtStudio) - 30,000โฝ
```

### 4. ะัะธััะบะฐ ะบะพัะทะธะฝั
```
๐ค "ะัะธััะธ ะบะพัะทะธะฝั"
๐ค ๐๏ธ ะะพัะทะธะฝะฐ ะพัะธัะตะฝะฐ
```

---

## ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ
โ   ะะพะปัะทะพะฒะฐัะตะปั  โ
โ  (ะณะพะปะพั/ัะตะบัั)  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ   AI Chat API   โ /api/ai/chat
โ  (Gemini 2.0)   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ Function Call
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  AI Cart API    โ /api/cart/ai
โ (add/remove/    โ
โ  show/clear)    โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ    Supabase     โ
โ   cart_items    โ
โโโโโโโโโโโโโโโโโโโ
```

### ะคัะฝะบัะธะธ (Tools)

#### 1. `add_to_cart`
```typescript
{
  name: 'add_to_cart',
  description: 'ะะพะฑะฐะฒะธัั ััะปัะณั ะธะปะธ ะฟัะพะณัะฐะผะผั ะฒ ะบะพัะทะธะฝั ะฟะพะปัะทะพะฒะฐัะตะปั',
  parameters: {
    serviceId: string,  // ID ััะปัะณะธ (ะพะฑัะทะฐัะตะปัะฝะพ)
    notes: string       // ะัะธะผะตัะฐะฝะธะต (ะฝะฐะฟัะธะผะตั, "ะัะตะผะธัะผ")
  }
}
```

**ะะพะณะธะบะฐ:**
- ะัะพะฒะตััะตั ัััะตััะฒะพะฒะฐะฝะธะต ััะปัะณะธ
- ะัะพะฒะตััะตั ะดัะฑะปะธะบะฐัั (ะฟะพ `serviceId` + `notes`)
- ะะพะฑะฐะฒะปัะตั ะฒ `cart_items`
- ะะพะทะฒัะฐัะฐะตั ะฟะพะดัะฒะตัะถะดะตะฝะธะต

#### 2. `remove_from_cart`
```typescript
{
  name: 'remove_from_cart',
  description: 'ะฃะดะฐะปะธัั ััะปัะณั ะธะท ะบะพัะทะธะฝั ะฟะพะปัะทะพะฒะฐัะตะปั',
  parameters: {
    serviceId: string  // ID ััะปัะณะธ ะดะปั ัะดะฐะปะตะฝะธั
  }
}
```

#### 3. `show_cart`
```typescript
{
  name: 'show_cart',
  description: 'ะะพะบะฐะทะฐัั ัะพะดะตัะถะธะผะพะต ะบะพัะทะธะฝั ะฟะพะปัะทะพะฒะฐัะตะปั',
  parameters: {}
}
```

**ะะพะทะฒัะฐัะฐะตั:**
```json
{
  "items": [
    {
      "id": "cart_item_id",
      "service_id": "service_id",
      "title": "ะะตะฝั ัะพะถะดะตะฝะธั",
      "price": 20000,
      "duration": 120,
      "profile_name": "KidsPoint",
      "profile_slug": "kidspoint",
      "notes": "ะัะตะผะธัะผ"
    }
  ],
  "total": 50000,
  "count": 2,
  "message": "๐ ะ ะบะพัะทะธะฝะต 2 ััะปัะณะธ ะฝะฐ ััะผะผั 50,000โฝ"
}
```

#### 4. `clear_cart`
```typescript
{
  name: 'clear_cart',
  description: 'ะัะธััะธัั ะฒัั ะบะพัะทะธะฝั ะฟะพะปัะทะพะฒะฐัะตะปั',
  parameters: {}
}
```

---

## ๐ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะะพะฑะฐะฒะปะตะฝะธะต ะฟะฐะบะตัะฐ ั ัะฐัะธัะพะผ
```
๐ค: ะะฐััะบะฐะถะธ ะฟัะพ KidsPoint
๐ค: KidsPoint ะฟัะตะดะปะฐะณะฐะตั ะฟะฐะบะตั "ะะตะฝั ัะพะถะดะตะฝะธั":
    - ะญะบะพะฝะพะผ (20,000โฝ): 2 ัะฐัะฐ, ะดะพ 10 ะดะตัะตะน
    - ะกัะฐะฝะดะฐัั (26,000โฝ): 2.5 ัะฐัะฐ, ะดะพ 15 ะดะตัะตะน
    - ะัะตะผะธัะผ (30,000โฝ): 3 ัะฐัะฐ, ะดะพ 20 ะดะตัะตะน

๐ค: ะะพะฑะฐะฒั ะฟะฐะบะตั ะัะตะผะธัะผ
๐ค: [Function Call: add_to_cart(serviceId="...", notes="ะัะตะผะธัะผ")]
    โ ะะพะฑะฐะฒะปะตะฝะพ ะฒ ะบะพัะทะธะฝั: ะะฐะบะตั "ะัะตะผะธัะผ" (30,000โฝ)
```

### ะัะธะผะตั 2: ะะพะผะฟะปะตะบัะฝัะน ะทะฐะฟัะพั
```
๐ค: ะะพะฑะฐะฒั KidsPoint ะธ ArtStudio ะฒ ะบะพัะทะธะฝั
๐ค: [Function Call 1: add_to_cart(serviceId="kp_id")]
    [Function Call 2: add_to_cart(serviceId="as_id")]
    โ ะะพะฑะฐะฒะปะตะฝะพ:
    - "ะะตะฝั ัะพะถะดะตะฝะธั" ะพั KidsPoint (20,000โฝ)
    - "ะะฐััะตั-ะบะปะฐัั" ะพั ArtStudio (5,000โฝ)
```

### ะัะธะผะตั 3: ะะพะปะพัะพะฒะพะต ะดะพะฑะฐะฒะปะตะฝะธะต
```
๐ค: ๐ค "ะะพะฑะฐะฒั ััั ัััะดะธั ะฒ ะบะพัะทะธะฝั"
๐ค: [STT โ Gemini] โ [Function Call]
    โ ะะพะฑะฐะฒะปะตะฝะพ ะฒ ะบะพัะทะธะฝั: "ะะตะฝั ัะพะถะดะตะฝะธั" ะพั KidsPoint
```

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะะฒัะพัะธะทะฐัะธั
- ะัะต ััะฝะบัะธะธ ััะตะฑััั ะฐะฒัะพัะธะทะพะฒะฐะฝะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- Cookie ะฟะตัะตะดะฐะตััั ัะตัะตะท headers ะฟัะธ ะฒัะทะพะฒะต `/api/cart/ai`

### ะะฐะปะธะดะฐัะธั
- ะัะพะฒะตัะบะฐ ัััะตััะฒะพะฒะฐะฝะธั ััะปัะณะธ
- ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะดะพัััะฟะฐ
- ะัะพะฒะตัะบะฐ ะดัะฑะปะธะบะฐัะพะฒ

### Rate Limiting
- ะัะธะผะตะฝัะตััั ะพะฑัะธะน ะปะธะผะธั AI-ัะฐัะฐ (20 ัะพะพะฑัะตะฝะธะน/ัะฐั)
- Function calls ััะธััะฒะฐัััั ะบะฐะบ ะพะฑััะฝัะต ัะพะพะฑัะตะฝะธั

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะะพะผะฐะฝะดั ะดะปั ะฟัะพะฒะตัะบะธ

**ะะพะฑะฐะฒะปะตะฝะธะต:**
```
- "ะะพะฑะฐะฒั KidsPoint ะฒ ะบะพัะทะธะฝั"
- "ะฅะพัั ะฟะฐะบะตั ะัะตะผะธัะผ"
- "ะะพะฑะฐะฒั ััั ัััะดะธั"
```

**ะฃะดะฐะปะตะฝะธะต:**
```
- "ะฃะดะฐะปะธ KidsPoint"
- "ะฃะฑะตัะธ ะธะท ะบะพัะทะธะฝั"
- "ะฃะดะฐะปะธ ะฟะพัะปะตะดะฝัั ััะปัะณั"
```

**ะัะพัะผะพัั:**
```
- "ะงัะพ ั ะผะตะฝั ะฒ ะบะพัะทะธะฝะต?"
- "ะะพะบะฐะถะธ ะบะพัะทะธะฝั"
- "ะกะบะพะปัะบะพ ั ะผะตะฝั ะฒ ะบะพัะทะธะฝะต?"
```

**ะัะธััะบะฐ:**
```
- "ะัะธััะธ ะบะพัะทะธะฝั"
- "ะฃะดะฐะปะธ ะฒัั ะธะท ะบะพัะทะธะฝั"
- "ะะฐัะฐัั ัะฝะฐัะฐะปะฐ"
```

---

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะะพะณะธ
```typescript
console.log('[AI Chat] Function call: add_to_cart', { serviceId, notes })
console.log('[AI Cart] Insert error:', insertError)
```

### ะัะปะฐะดะบะฐ
ะ ะพัะฒะตัะต API ะดะพะฑะฐะฒะปะตะฝะพ ะฟะพะปะต `function_calls` ะดะปั ะพัะปะฐะดะบะธ:
```json
{
  "response": "โ ะะพะฑะฐะฒะปะตะฝะพ ะฒ ะบะพัะทะธะฝั",
  "function_calls": ["add_to_cart"],
  "suggestions": [...]
}
```

---

## ๐ ะะปะฐะฝั ะฝะฐ ะฑัะดััะตะต

### ะคะฐะทะฐ 2: ะะฐะฒะธะณะฐัะธั
- `open_profile(slug)` - ะพัะบัััั ะฟัะพัะธะปั
- `show_services(profileId)` - ะฟะพะบะฐะทะฐัั ััะปัะณะธ
- `filter_by_category(category)` - ัะธะปััั ะฟะพ ะบะฐัะตะณะพัะธะธ

### ะคะฐะทะฐ 3: ะัะพัะผะปะตะฝะธะต ะทะฐะบะฐะทะฐ
- `create_order()` - ัะพะทะดะฐัั ะทะฐะบะฐะท ะธะท ะบะพัะทะธะฝั
- `add_comment(text)` - ะดะพะฑะฐะฒะธัั ะบะพะผะผะตะฝัะฐัะธะน ะบ ะทะฐะบะฐะทั
- `select_date(date)` - ะฒัะฑัะฐัั ะดะฐัั ะฟัะฐะทะดะฝะธะบะฐ

---

## ๐ ะกะฒัะทะฐะฝะฝัะต ะดะพะบัะผะตะฝัั

- [AI Vector Search](./AI_VECTOR_SEARCH.md)
- [AI Protection](./AI_PROTECTION_AND_FEATURES.md)
- [STT Settings](./STT_SETTINGS.md)

---

**ะะฒัะพั:** ZumZam AI Team  
**ะะฐัะฐ:** 10.12.2025  
**ะะตััะธั:** 1.0















