# ‚úÖ AI —á–∞—Ç –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ - –ü–û–õ–ù–û–°–¢–¨–Æ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–´

## üéâ –ß—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ pgvector ‚úÖ
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector 0.8.0 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ Yandex Cloud PostgreSQL
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `profiles.embedding` –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞ –≤ `vector(768)`
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `search_profiles_by_vector` –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω HNSW –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–µ–µ IVFFlat)

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings ‚úÖ
- ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã embeddings –¥–ª—è **38 –ø—Ä–æ—Ñ–∏–ª–µ–π**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Gemini text-embedding-004 (768 —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å)
- ‚úÖ –í—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

### 3. AI —á–∞—Ç —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º ‚úÖ
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π AI —á–∞—Ç —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
- ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ pgvector + HNSW
- ‚úÖ Fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ (3 —à—Ç—É–∫–∏)
- ‚úÖ Rate limiting (20 —Å–æ–æ–±—â–µ–Ω–∏–π/—á–∞—Å)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|--------|--------|
| pgvector | ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ | –í–µ—Ä—Å–∏—è 0.8.0 |
| HNSW –∏–Ω–¥–µ–∫—Å | ‚úÖ –°–æ–∑–¥–∞–Ω | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞ |
| –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `search_profiles_by_vector` |
| Embeddings | ‚úÖ –°–æ–∑–¥–∞–Ω—ã | 38 –∏–∑ 50 –ø—Ä–æ—Ñ–∏–ª–µ–π |
| AI —á–∞—Ç | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –° –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º |
| –ü—Ä–æ–º–ø—Ç—ã | ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã | –ü–æ–ª–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç |

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç –≤–æ–ø—Ä–æ—Å**: "–ù–∞–π–¥–∏ –¥–µ—Ç—Å–∫—É—é —Å—Ç—É–¥–∏—é –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞"
2. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è embedding**: Gemini —Å–æ–∑–¥–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä (768 —á–∏—Å–µ–ª) –∏–∑ –≤–æ–ø—Ä–æ—Å–∞
3. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫**: pgvector –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ —á–µ—Ä–µ–∑ HNSW –∏–Ω–¥–µ–∫—Å
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**: –ü—Ä–æ—Ñ–∏–ª–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏ (similarity score)
5. **AI –æ—Ç–≤–µ—Ç**: Gemini –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```typescript
// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding
const queryEmbedding = await generateEmbedding("—Ç–≤–æ—Ä—á–µ—Å–∫–∞—è —Å—Ç—É–¥–∏—è –¥–ª—è –¥–µ—Ç–µ–π 5 –ª–µ—Ç")

// –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
const profiles = await prisma.$queryRawUnsafe(`
  SELECT * FROM search_profiles_by_vector(
    $1::vector(768),
    0.3,  -- –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å 30%
    8     -- –º–∞–∫—Å. 8 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  )
`, `[${queryEmbedding.join(',')}]`)

// –†–µ–∑—É–ª—å—Ç–∞—Ç: –ø—Ä–æ—Ñ–∏–ª–∏ —Å –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å–∞–º–∏, –∞—Ä—Ç-—Å—Ç—É–¥–∏–∏, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ —Ü–µ–Ω—Ç—Ä—ã
// –î–∞–∂–µ –µ—Å–ª–∏ —Å–ª–æ–≤–æ "—Ç–≤–æ—Ä—á–µ—Å–∫–∞—è" –Ω–µ —É–ø–æ–º—è–Ω—É—Ç–æ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏!
```

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

### –î–æ (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫):
```
–ó–∞–ø—Ä–æ—Å: "–ù–∞–π–¥–∏ –º–µ—Å—Ç–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞"
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (—Å–ª–æ–≤–∞ "–∞–∫—Ç–∏–≤–Ω—ã–π" –Ω–µ—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—è—Ö)
```

### –ü–æ—Å–ª–µ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫):
```
–ó–∞–ø—Ä–æ—Å: "–ù–∞–π–¥–∏ –º–µ—Å—Ç–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞"
–†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ
  - –ë–∞—Ç—É—Ç–Ω—ã–π —Ü–µ–Ω—Ç—Ä (87% —Å—Ö–æ–∂–µ—Å—Ç—å)
  - –°–∫–∞–ª–æ–¥—Ä–æ–º (82%)
  - –õ–∞–∑–µ—Ä—Ç–∞–≥ (78%)
  - –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å (75%)
```

**–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª!** –û–Ω –∑–Ω–∞–µ—Ç, —á—Ç–æ "–∞–∫—Ç–∏–≤–Ω—ã–π" —Å–≤—è–∑–∞–Ω–æ —Å "–±–∞—Ç—É—Ç—ã", "—Å–∫–∞–ª–æ–ª–∞–∑–∞–Ω–∏–µ", "—Å–ø–æ—Ä—Ç".

## üìù –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

1. **`scripts/check-available-extensions.ts`** - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π PostgreSQL
2. **`scripts/fix-embedding-column.ts`** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ vector(768)
3. **`scripts/setup-vector-search-final.ts`** - –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ HNSW –∏–Ω–¥–µ–∫—Å–∞
4. **`scripts/generate-embeddings.ts`** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
npx tsx scripts/check-available-extensions.ts

# –ü—Ä–æ–≤–µ—Ä–∫–∞ embeddings
npx tsx scripts/check-embeddings.ts
```

### –û–±–Ω–æ–≤–∏—Ç—å embeddings (–ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π)
```bash
npx tsx scripts/generate-embeddings.ts
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
```sql
-- –ü—Ä—è–º–æ–π SQL –∑–∞–ø—Ä–æ—Å –≤ –±–∞–∑–µ
SELECT * FROM search_profiles_by_vector(
  '[0.1, 0.2, ...]'::vector(768),  -- –≤–∞—à embedding
  0.3,  -- threshold
  10    -- limit
);
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings
–î–æ–±–∞–≤–∏—Ç—å —Ö—É–∫ –≤ API —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π:

```typescript
// app/api/profiles/route.ts
async function POST(request: NextRequest) {
  // ... —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è ...
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º embedding
  const embedding = await generateEmbedding(
    `${profile.display_name}\n${profile.bio}\n${profile.description}`
  )
  
  await prisma.$executeRawUnsafe(
    `UPDATE profiles SET embedding = $1::vector(768) WHERE id = $2::uuid`,
    `[${embedding.join(',')}]`,
    profile.id
  )
}
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞
–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å relevance scores –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

```typescript
console.log('[AI Chat] Search results:',
  profiles.map(p => ({
    name: p.display_name,
    similarity: p.similarity
  }))
)
```

### 3. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–°—Ä–∞–≤–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤:
- –ì—Ä—É–ø–ø–∞ A: –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- –ì—Ä—É–ø–ø–∞ B: —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
- –ú–µ—Ç—Ä–∏–∫–∏: CTR, –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–≤–µ—Ç, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: `docs/AI_CHAT_RESTORATION.md`
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ pgvector**: `docs/YANDEX_CLOUD_PGVECTOR_SETUP.md`
- **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫**: `docs/AI_VECTOR_SEARCH.md`
- **–ó–∞—â–∏—Ç–∞ AI**: `docs/AI_PROTECTION_AND_FEATURES.md`

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [x] pgvector —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [x] HNSW –∏–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞–Ω
- [x] –§—É–Ω–∫—Ü–∏—è search_profiles_by_vector —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Embeddings —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–µ–π
- [x] AI —á–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
- [x] Fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –ü—Ä–æ–º–ø—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [x] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

## üéâ –ò—Ç–æ–≥

**AI —á–∞—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —É–ª—É—á—à–µ–Ω!**

- –†–∞–±–æ—Ç–∞–µ—Ç —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º —á–µ—Ä–µ–∑ pgvector 0.8.0
- –ü–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª –∑–∞–ø—Ä–æ—Å–æ–≤, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
- –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
- 38 –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
- Fallback –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

**–ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!** üöÄ

