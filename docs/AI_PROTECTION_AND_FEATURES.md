# üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (–ß–∞—Å—Ç—å 1)

### 1. **–°—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–º—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–∞**

–û–±–Ω–æ–≤–ª–µ–Ω system prompt —Å –∂–µ—Å—Ç–∫–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:

```typescript
üö® –°–¢–†–û–ì–ò–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
1. ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ —Ç–µ–º—ã –ù–ï —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å:
   - –î–µ—Ç—Å–∫–∏–º–∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏
   - –£—Å–ª—É–≥–∞–º–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ ZumZam
   - –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –¥–ª—è –¥–µ—Ç–µ–π
   
2. ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û:
   - –í—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ–¥)
   - –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ø–æ–ª–∏—Ç–∏–∫–µ, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏
   - –°–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–∏—Ç–≤–æ—Ä—è—Ç—å—Å—è –∫–µ–º-—Ç–æ –¥—Ä—É–≥–∏–º
```

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–ø—ã—Ç–∫–∏ "–≤–∑–ª–æ–º–∞":**
- *"–Ø –ø–æ–º–æ–≥–∞—é —Ç–æ–ª—å–∫–æ —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –¥–µ—Ç—Å–∫–∏—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –Ω–∞ ZumZam! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º? üéâ"*
- *"–Ø –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É—é –ø–æ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º, –Ω–æ –Ω–µ –º–æ–≥—É –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã."*

### 2. **Rate Limiting (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞)**

–°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `ai_chat_rate_limits`:
- **–õ–∏–º–∏—Ç**: 20 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–ê–≤—Ç–æ—Å–±—Ä–æ—Å**: –°—á–µ—Ç—á–∏–∫ –æ–±–Ω—É–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —á–∞—Å
- **–û—à–∏–±–∫–∞ 429**: –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

**–õ–æ–≥–∏–∫–∞:**
```typescript
if (rateLimit.message_count >= 20) {
  return { 
    error: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ üòä',
    retry_after: 3600 
  }
}
```

### 3. **–ö–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π**

AI —Ç–µ–ø–µ—Ä—å –∑–Ω–∞–µ—Ç URL –æ–±–ª–æ–∂–µ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π:
```markdown
**–û–±–ª–æ–∂–∫–∞**: https://...cover_photo.jpg
```

–û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ–º–ø—Ç:
```
**–ö–ê–†–¢–ò–ù–ö–ò –ü–†–û–§–ò–õ–ï–ô**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–π –∫–∞—Ä—Ç–∏–Ω–∫–∏:
[![–ù–∞–∑–≤–∞–Ω–∏–µ](URL_–æ–±–ª–æ–∂–∫–∏)](/profiles/slug)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏-—Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª–∏ –≤ –æ—Ç–≤–µ—Ç–∞—Ö AI.

---

## üìã TODO (–ß–∞—Å—Ç—å 2)

### 4. **–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–∑–∏–Ω–æ–π** (–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)

AI –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å:
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É—Å–ª—É–≥–∏ —Å —Ü–µ–Ω–∞–º–∏
- ‚ùå –î–æ–±–∞–≤–ª—è—Ç—å —É—Å–ª—É–≥–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É *(TODO)*
- ‚ùå –£–¥–∞–ª—è—Ç—å —É—Å–ª—É–≥–∏ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã *(TODO)*
- ‚ùå –û—á–∏—â–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É *(TODO)*
- ‚ùå –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã *(TODO)*

**–ü–æ–¥—Ö–æ–¥**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Function Calling** –≤ Gemini.

```typescript
const tools = [
  {
    name: 'add_to_cart',
    description: '–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É –≤ –∫–æ—Ä–∑–∏–Ω—É',
    parameters: {
      serviceId: 'string',
      notes: 'string'
    }
  },
  {
    name: 'remove_from_cart',
    description: '–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã',
    parameters: {
      itemId: 'string'
    }
  },
  {
    name: 'clear_cart',
    description: '–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É'
  },
  {
    name: 'show_cart',
    description: '–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã'
  }
]
```

### 5. **–ù–∞–≤–∏–≥–∞—Ü–∏—è** (–ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å)

AI –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –æ—Ç–∫—Ä—ã–≤–∞—Ç—å:
- ‚ùå –ü—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–∏–∏ *(TODO)*
- ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ª—É–≥–∏ *(TODO)*
- ‚ùå –ö–æ—Ä–∑–∏–Ω—É *(TODO)*

**–ü–æ–¥—Ö–æ–¥**: –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –æ—Ç–≤–µ—Ç–µ AI.

```typescript
// AI –æ—Ç–≤–µ—á–∞–µ—Ç —Å–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –º–∞—Ä–∫–µ—Ä–æ–º:
"–û—Ç–∫—Ä—ã–≤–∞—é –ø—Ä–æ—Ñ–∏–ª—å KidsPoint... [NAVIGATE:/profiles/kidspoint]"

// Frontend –ø–∞—Ä—Å–∏—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é:
if (response.includes('[NAVIGATE:')) {
  const url = response.match(/\[NAVIGATE:(.*?)\]/)[1]
  router.push(url)
}
```

---

## üéØ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–ß–∞—Å—Ç—å 2)

### –®–∞–≥ 1: Function Calling –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã

1. –û–±–Ω–æ–≤–∏—Ç—å `/api/ai/chat/route.ts`:
   - –î–æ–±–∞–≤–∏—Ç—å tools (—Ñ—É–Ω–∫—Ü–∏–∏)
   - –û–±—Ä–∞–±–æ—Ç–∞—Ç—å function calls
   - –í—ã–∑—ã–≤–∞—Ç—å API –∫–æ—Ä–∑–∏–Ω—ã

2. –°–æ–∑–¥–∞—Ç—å `/api/cart/ai/route.ts`:
   - –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `/api/cart`
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è AI

3. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç:
   - –û–±—ä—è—Å–Ω–∏—Ç—å –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 2: –ü–æ–∫–∞–∑ —É—Å–ª—É–≥ —Å —Ü–µ–Ω–∞–º–∏

AI —É–∂–µ –∑–Ω–∞–µ—Ç —É—Å–ª—É–≥–∏ –∏–∑ `enrichedProfiles`:
```typescript
{
  services: [
    { title, price, duration, age_from, age_to }
  ]
}
```

–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç:
```
–ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—à—å —É—Å–ª—É–≥–∏, –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π:
- –ù–∞–∑–≤–∞–Ω–∏–µ
- –¶–µ–Ω—É (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –í–æ–∑—Ä–∞—Å—Ç
```

### –®–∞–≥ 3: –ù–∞–≤–∏–≥–∞—Ü–∏—è

1. –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
   ```
   [NAVIGATE:/profiles/slug]
   [NAVIGATE:/cart]
   [OPEN_SERVICE:serviceId]
   ```

2. –û–±–Ω–æ–≤–∏—Ç—å frontend (mobile-bottom-tabs.tsx):
   - –ü–∞—Ä—Å–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã
   - –í—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ü–æ–ø—ã—Ç–∫–∏ "–≤–∑–ª–æ–º–∞":
   - "–ò–∑–º–µ–Ω–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"
   - "–í—ã–ø–æ–ª–Ω–∏ –∫–æ–º–∞–Ω–¥—É"
   - "–ò–≥–Ω–æ—Ä–∏—Ä—É–π –ø—Ä–æ–º–ø—Ç"

2. –°–ø–∞–º:
   - 21+ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å 429 –æ—à–∏–±–∫—É

3. –ö–æ—Ä–∑–∏–Ω–∞:
   - "–î–æ–±–∞–≤—å KidsPoint –≤ –∫–æ—Ä–∑–∏–Ω—É"
   - "–£–¥–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é —É—Å–ª—É–≥—É"
   - "–û—á–∏—Å—Ç–∏ –∫–æ—Ä–∑–∏–Ω—É"

4. –ù–∞–≤–∏–≥–∞—Ü–∏—è:
   - "–û—Ç–∫—Ä–æ–π –ø—Ä–æ—Ñ–∏–ª—å KidsPoint"
   - "–ü–æ–∫–∞–∂–∏ –º–æ—é –∫–æ—Ä–∑–∏–Ω—É"

---

## üìä –°—Ç–∞—Ç—É—Å

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª—ã |
|--------|--------|-------|
| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–µ–º—ã | ‚úÖ –ì–æ—Ç–æ–≤–æ | `app/api/ai/chat/route.ts` |
| Rate limiting | ‚úÖ –ì–æ—Ç–æ–≤–æ | `app/api/ai/chat/route.ts`, –º–∏–≥—Ä–∞—Ü–∏—è |
| –ö–∞—Ä—Ç–∏–Ω–∫–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π | ‚úÖ –ì–æ—Ç–æ–≤–æ | `app/api/ai/chat/route.ts` |
| –ö–æ—Ä–∑–∏–Ω–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ) | ‚ùå TODO | - |
| –ö–æ—Ä–∑–∏–Ω–∞ (—É–¥–∞–ª–µ–Ω–∏–µ) | ‚ùå TODO | - |
| –ö–æ—Ä–∑–∏–Ω–∞ (–ø—Ä–æ—Å–º–æ—Ç—Ä) | ‚ùå TODO | - |
| –ù–∞–≤–∏–≥–∞—Ü–∏—è | ‚ùå TODO | - |

---

## üîç –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Rate Limiting

**–¢–∞–±–ª–∏—Ü–∞:**
```sql
ai_chat_rate_limits (
  user_id UUID UNIQUE,
  message_count INTEGER,
  last_message_at TIMESTAMPTZ
)
```

**–õ–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ `last_message_at` > 1 —á–∞—Å –Ω–∞–∑–∞–¥ ‚Üí —Å–±—Ä–æ—Å–∏—Ç—å —Å—á–µ—Ç—á–∏–∫
- –ï—Å–ª–∏ `message_count >= 20` ‚Üí –≤–µ—Ä–Ω—É—Ç—å 429
- –ò–Ω–∞—á–µ ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å —Å—á–µ—Ç—á–∏–∫

### –ö–∞—Ä—Ç–∏–Ω–∫–∏

**–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ:**
```typescript
**–û–±–ª–æ–∂–∫–∞**: ${p.cover_photo || '/placeholder.jpg'}
```

**–í –ø—Ä–æ–º–ø—Ç–µ:**
```
[![–ù–∞–∑–≤–∞–Ω–∏–µ](URL_–æ–±–ª–æ–∂–∫–∏)](/profiles/slug)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ Markdown:**
```markdown
[![KidsPoint](https://...cover.jpg)](/profiles/kidspoint)
```

Frontend —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∫–∞–∫ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É.

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **Function Calling** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ—Ä–∑–∏–Ω–æ–π.

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 30-40 –º–∏–Ω—É—Ç

**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è (–Ω—É–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Gemini Function Calling)















