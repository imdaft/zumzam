# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∏ Webpack

## –ü—Ä–æ–±–ª–µ–º–∞ 1: Permissions Policy

```
[Violation] Permissions policy violation: microphone is not allowed in this document.
NotAllowedError: Permission denied
```

### –†–µ—à–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–µ–Ω `next.config.ts`:

```typescript
// ‚ùå –ë—ã–ª–æ (–∑–∞–ø—Ä–µ—â–µ–Ω–æ):
{
  key: 'Permissions-Policy',
  value: 'camera=(), microphone=(), geolocation=()'
}

// ‚úÖ –°—Ç–∞–ª–æ (—Ä–∞–∑—Ä–µ—à–µ–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –¥–æ–º–µ–Ω–∞):
{
  key: 'Permissions-Policy',
  value: 'camera=(), microphone=(self), geolocation=()'
}
```

---

## –ü—Ä–æ–±–ª–µ–º–∞ 2: Webpack –æ—à–∏–±–∫–∏ —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏

```
Module parse failed: Unexpected character 'ÔøΩ' (1:2)
./node_modules/@xenova/transformers/node_modules/sharp/build/Release/sharp-win32-x64.node
./node_modules/onnxruntime-node/bin/napi-v3/win32/x64/onnxruntime_binding.node
```

### –ü—Ä–∏—á–∏–Ω–∞

Webpack –ø—ã—Ç–∞–µ—Ç—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Node.js –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã (`.node`) –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥, –Ω–æ –æ–Ω–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞.

### –†–µ—à–µ–Ω–∏–µ (–§–ò–ù–ê–õ–¨–ù–û–ï)

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `next.config.ts`:

```typescript
experimental: {
  // –£–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–∫–µ—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  serverComponentsExternalPackages: ['@xenova/transformers', 'sharp', 'onnxruntime-node'],
},

webpack: (config, { isServer }) => {
  // –¢–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–æ–¥—É–ª–∏
  if (!isServer) {
    config.resolve.alias = {
      ...config.resolve.alias,
      '@xenova/transformers': false,
      'sharp': false,
      'onnxruntime-node': false,
    }
  }

  return config
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- `serverComponentsExternalPackages` - –ø–æ–º–µ—á–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –∫–∞–∫ "—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞"
- `config.resolve.alias = false` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —ç—Ç–∏ –º–æ–¥—É–ª–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- Next.js –Ω–µ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –±–∞–Ω–¥–ª–∏—Ç—å –∏—Ö –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–¥

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π (Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
npm run dev
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:

1. ‚úÖ –ù–∏–∫–∞–∫–∏—Ö webpack –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:4000`
3. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ AI —á–∞—Ç
4. ‚úÖ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ üé§
5. ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
6. ‚úÖ –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø ‚Üí –∑–∞–ø–∏—Å—å –Ω–∞—á–Ω–µ—Ç—Å—è

---

## –û–±—ä—è—Å–Ω–µ–Ω–∏–µ

### `microphone=(self)`
- –ú–∏–∫—Ä–æ—Ñ–æ–Ω –¥–æ—Å—Ç—É–ø–µ–Ω **—Ç–æ–ª—å–∫–æ** –Ω–∞ —ç—Ç–æ–º –¥–æ–º–µ–Ω–µ (localhost:4000)
- –§—Ä–µ–π–º—ã/iframe —Å –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–æ–≤ **–Ω–µ** —Å–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è production

### `null-loader`
- –ó–∞–º–µ–Ω—è–µ—Ç –∏–º–ø–æ—Ä—Ç—ã `.node` —Ñ–∞–π–ª–æ–≤ –Ω–∞ –ø—É—Å—Ç—ã–µ –º–æ–¥—É–ª–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ webpack –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–æ–¥–∞
- –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### `config.externals`
- –ü–æ–º–µ—á–∞–µ—Ç `@xenova/transformers` –∫–∞–∫ –≤–Ω–µ—à–Ω—é—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- Next.js –Ω–µ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –±–∞–Ω–¥–ª–∏—Ç—å –µ—ë –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–æ–¥
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `require()`

---

‚úÖ –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—Å–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!


