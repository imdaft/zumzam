# AI –ü–æ–º–æ—â–Ω–∏–∫ ‚Äî –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

AI –ü–æ–º–æ—â–Ω–∏–∫ –≤ ZumZam –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Gemini 2.0 Flash** –∏ **–≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Supabase pgvector** –¥–ª—è –ø–æ–º–æ—â–∏ —Ä–æ–¥–∏—Ç–µ–ª—è–º –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç—Å–∫–∏—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤.

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. Frontend (UI)

**–§–∞–π–ª:** `components/shared/mobile-bottom-tabs.tsx`

- –ö–Ω–æ–ø–∫–∞ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –º–µ–Ω—é (–æ—Ä–∞–Ω–∂–µ–≤–∞—è –∫–∞–ø—Å—É–ª–∞)
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —á–∞—Ç–∞ –≤ —Å—Ç–∏–ª–µ –Ø–Ω–¥–µ–∫—Å–∞
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (user/assistant)
- –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
- –ö–Ω–æ–ø–∫–∞ "–ù–æ–≤—ã–π —á–∞—Ç" –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
- –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞

### 2. Backend (API)

**–§–∞–π–ª:** `app/api/ai/chat/route.ts`

**POST `/api/ai/chat`**

**Request:**
```json
{
  "message": "–ü–æ–º–æ–≥–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞ 7 –ª–µ—Ç",
  "conversationHistory": [
    { "role": "user", "content": "..." },
    { "role": "assistant", "content": "..." }
  ]
}
```

**Response:**
```json
{
  "response": "–ö–æ–Ω–µ—á–Ω–æ! –î–ª—è —Ä–µ–±–µ–Ω–∫–∞ 7 –ª–µ—Ç...",
  "profiles": [
    {
      "id": "...",
      "slug": "kidspoint",
      "display_name": "KidsPoint",
      "category": "studios",
      "rating": 5.0,
      "price_from": 2000,
      "similarity": 0.85
    }
  ]
}
```

### 3. Database (Vector Search)

**–§—É–Ω–∫—Ü–∏—è:** `search_profiles_by_vector`

**–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:** `supabase/migrations/*_add_vector_search_function.sql`

```sql
CREATE OR REPLACE FUNCTION search_profiles_by_vector(
  query_embedding vector(768),
  match_threshold float DEFAULT 0.5,
  match_count int DEFAULT 5
)
RETURNS TABLE (
  id uuid,
  slug text,
  display_name text,
  short_description text,
  category text,
  rating numeric,
  reviews_count int,
  price_from numeric,
  city text,
  similarity float
)
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç embedding (–≤–µ–∫—Ç–æ—Ä 768 —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏) –æ—Ç Gemini
2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å `profiles.embedding` —á–µ—Ä–µ–∑ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (`<=>`)
3. –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `match_threshold` (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ—Ö–æ–∂–µ—Å—Ç—å)
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ø-N —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

---

## ü§ñ AI Pipeline

### –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Embedding

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Gemini Text Embedding 004**:

```typescript
const embeddingModel = genAI.getGenerativeModel({ model: 'text-embedding-004' })
const embeddingResult = await embeddingModel.embedContent(message)
const embedding = embeddingResult.embedding.values // vector(768)
```

### –®–∞–≥ 2: –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫

```typescript
const { data: profiles } = await supabase.rpc(
  'search_profiles_by_vector',
  {
    query_embedding: embedding,
    match_threshold: 0.5,
    match_count: 5
  }
)
```

### –®–∞–≥ 3: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è Gemini:

```text
- KidsPoint (studios)
  –†–µ–π—Ç–∏–Ω–≥: 5.0, –æ—Ç 2000 ‚ÇΩ
  –û–ø–∏—Å–∞–Ω–∏–µ: –î–µ—Ç—Å–∫–∞—è —Å—Ç—É–¥–∏—è —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º–∏ –ø–æ–¥ –∫–ª—é—á
  –ê–¥—Ä–µ—Å: –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
  –°—Å—ã–ª–∫–∞: /profiles/kidspoint
```

### –®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Gemini 2.0 Flash Exp** —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º:

```typescript
const model = genAI.getGenerativeModel({ model: 'gemini-2.0-flash-exp' })

const systemPrompt = `–¢—ã - AI –ø–æ–º–æ—â–Ω–∏–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ZumZam...`

const chat = model.startChat({
  history: [...conversationHistory],
  generationConfig: {
    temperature: 0.7,
    topP: 0.95,
    maxOutputTokens: 1024
  }
})

const result = await chat.sendMessage(message)
```

---

## üéØ –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç

```text
–¢—ã - AI –ø–æ–º–æ—â–Ω–∏–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ZumZam –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–µ—Ç—Å–∫–∏—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
- –ü–æ–º–æ–≥–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è–º –Ω–∞–π—Ç–∏ –∏–¥–µ–∞–ª—å–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –¥–ª—è –∏—Ö —Ä–µ–±–µ–Ω–∫–∞
- –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Å—Ç—É–¥–∏–∏, –∞–Ω–∏–º–∞—Ç–æ—Ä–æ–≤, —à–æ—É-–ø—Ä–æ–≥—Ä–∞–º–º—ã
- –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ —Ü–µ–Ω–∞—Ö, –≤–æ–∑—Ä–∞—Å—Ç–µ, –ª–æ–∫–∞—Ü–∏—è—Ö
- –ë—ã—Ç—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –ø–æ–ª–µ–∑–Ω—ã–º

–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥:
- studios (–î–µ—Ç—Å–∫–∏–µ —Å—Ç—É–¥–∏–∏)
- animators (–ê–Ω–∏–º–∞—Ç–æ—Ä—ã)
- show (–®–æ—É-–ø—Ä–æ–≥—Ä–∞–º–º—ã)
- quests (–ö–≤–µ—Å—Ç—ã)
- workshops (–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã)
- photographers (–§–æ—Ç–æ–≥—Ä–∞—Ñ—ã)
- videographers (–í–∏–¥–µ–æ–≥—Ä–∞—Ñ—ã)
- decoration (–î–µ–∫–æ—Ä –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ)

–í–ê–ñ–ù–û:
1. –í—Å–µ–≥–¥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
2. –£–∫–∞–∑—ã–≤–∞–π —Å—Å—ã–ª–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: "–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ [–ù–∞–∑–≤–∞–Ω–∏–µ](/profiles/slug)"
3. –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–µ–¥–ª–æ–∂–∏ —É—Ç–æ—á–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
4. –ë—É–¥—å –∫—Ä–∞—Ç–∫–∏–º –∏ –ø–æ –¥–µ–ª—É (2-3 –∞–±–∑–∞—Ü–∞)
5. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ üéâüéÇüéà
```

---

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã AI

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `model` | `gemini-2.0-flash-exp` | –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —á–∞—Ç–∞ |
| `embedding_model` | `text-embedding-004` | –ú–æ–¥–µ–ª—å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–æ–≤ (768D) |
| `temperature` | `0.7` | –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å (0-1) |
| `topP` | `0.95` | –°—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (nucleus) |
| `topK` | `40` | –¢–æ–ø-K —Ç–æ–∫–µ–Ω–æ–≤ |
| `maxOutputTokens` | `1024` | –ú–∞–∫—Å. –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞ |
| `match_threshold` | `0.5` | –ú–∏–Ω. –ø–æ—Ö–æ–∂–µ—Å—Ç—å (0-1) |
| `match_count` | `5` | –ú–∞–∫—Å. –ø—Ä–æ—Ñ–∏–ª–µ–π |

---

## üîë –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# .env.local
GEMINI_API_KEY=AIzaSy...
```

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è

**–í–æ–ø—Ä–æ—Å:** "–ü–æ–º–æ–≥–∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞ 7 –ª–µ—Ç"

**AI –æ—Ç–≤–µ—Ç:**
> üéâ –û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è! –î–ª—è 7-–ª–µ—Ç–Ω–µ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å:
> 
> - **[KidsPoint](/profiles/kidspoint)** ‚Äî –¥–µ—Ç—Å–∫–∞—è —Å—Ç—É–¥–∏—è —Å –ø–æ–ª–Ω—ã–º –ø–∞–∫–µ—Ç–æ–º —É—Å–ª—É–≥ (–æ—Ç 2000‚ÇΩ). –†–µ–π—Ç–∏–Ω–≥ 5.0, 25 –æ—Ç–∑—ã–≤–æ–≤.
> - **[–ü—Ä–∞–∑–¥–Ω–∏–∫ –ø–æ–¥ –∫–ª—é—á](/profiles/turnkey-party)** ‚Äî –æ—Ä–≥–∞–Ω–∏–∑—É—é—Ç –≤—Å—ë –æ—Ç –ê –¥–æ –Ø (–æ—Ç 5000‚ÇΩ).
> 
> –ß—Ç–æ –≤–∞—Å –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç: –∞–Ω–∏–º–∞—Ç–æ—Ä—ã, –∫–≤–µ—Å—Ç—ã –∏–ª–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã?

### –ü—Ä–∏–º–µ—Ä 2: –ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å

**–í–æ–ø—Ä–æ—Å:** "–ì–¥–µ –ø—Ä–æ–≤–µ—Å—Ç–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å –¥–ª—è –¥–µ—Ç–µ–π?"

**AI –æ—Ç–≤–µ—Ç:**
> üé® –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–ª–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
> 
> - **[Creative Studio](/profiles/creative-studio)** ‚Äî –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –ø–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—é, –ª–µ–ø–∫–µ (–æ—Ç 1500‚ÇΩ/—á–µ–ª).
> - **[ArtKids](/profiles/artkids)** ‚Äî —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã (–æ—Ç 1200‚ÇΩ/—á–µ–ª).
> 
> –î–ª—è –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –∏ —Å–∫–æ–ª—å–∫–∏—Ö –¥–µ—Ç–µ–π?

---

## üöÄ –†–∞–∑–≤–∏—Ç–∏–µ

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
3. ‚úÖ –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
4. ‚è≥ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (–≤ –ë–î)
5. ‚è≥ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
6. ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–æ—Ä–∑–∏–Ω–æ–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑ —á–∞—Ç–∞)
7. ‚è≥ –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥
8. ‚è≥ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ç–æ (Gemini Vision)

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

**–õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:**
```typescript
console.log('[AI Chat] User message:', message)
console.log('[AI Chat] Embedding:', embedding.slice(0, 5))
console.log('[AI Chat] Found profiles:', profiles.length)
console.log('[AI Chat] AI response:', response)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:**
```sql
SELECT * FROM search_profiles_by_vector(
  (SELECT embedding FROM profiles WHERE slug = 'kidspoint'),
  0.5,
  5
);
```

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Gemini API Docs](https://ai.google.dev/gemini-api/docs)
- [Supabase pgvector](https://supabase.com/docs/guides/ai/vector-embeddings)
- [Text Embedding 004](https://ai.google.dev/gemini-api/docs/models/gemini#text-embedding)















