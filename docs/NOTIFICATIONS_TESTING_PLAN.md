# –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Å–æ–æ–±—â–µ–Ω–∏–π

## üìã –¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò (15 —à—Ç—É–∫)

### üîî –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø

**1. –°–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–ù–æ–≤—ã–π –∑–∞–∫–∞–∑"
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—á—ë—Ç—á–∏–∫ +1 –≤ —Ö–µ–¥–µ—Ä–µ, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ dropdown, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ /orders

**2. –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ dropdown**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Ç–∫—Ä—ã—Ç—å dropdown, –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º, —Å—á—ë—Ç—á–∏–∫ -1
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°–æ–±—ã—Ç–∏–µ `notification-read` dispatch, UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

**3. –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /notifications**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∫–ª–∏–∫–Ω—É—Ç—å "–ü—Ä–æ—á–∏—Ç–∞—Ç—å"
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—á—ë—Ç—á–∏–∫ –≤ —Ö–µ–¥–µ—Ä–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—á–µ—Ä–µ–∑ —Å–æ–±—ã—Ç–∏–µ)

**4. –ü—Ä–æ—á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ö–ª–∏–∫–Ω—É—Ç—å "–ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /notifications
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–º–µ—á–∞—é—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—á—ë—Ç—á–∏–∫ –æ–±–Ω—É–ª—è–µ—Ç—Å—è, dropdown –ø—É—Å—Ç

**5. –§–∏–ª—å—Ç—Ä "–¢–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ"**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –Ω–∞ /notifications
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**6. –£–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ö–ª–∏–∫–Ω—É—Ç—å "–£–¥–∞–ª–∏—Ç—å" –≤ dropdown (—á–µ—Ä–µ–∑ –º–µ–Ω—é ‚ãÆ)
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—á—ë—Ç—á–∏–∫ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏—Å—á–µ–∑–∞–µ—Ç

**7. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—á—ë—Ç—á–∏–∫–æ–≤ –º–µ–∂–¥—É —Ç–∞–±–∞–º–∏**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç –≤ 2 —Ç–∞–±–∞—Ö, –ø—Ä–æ—á–∏—Ç–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–º
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –°—á—ë—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –æ–±–æ–∏—Ö —Ç–∞–±–∞—Ö
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** CustomEvent —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `window.addEventListener`

---

### üí¨ –°–û–û–ë–©–ï–ù–ò–Ø

**8. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ –∑–∞–∫–∞–∑–∞**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é –≤ —á–∞—Ç–µ –∑–∞–∫–∞–∑–∞
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å `sender_role: 'client'`
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í –ë–î –ø–æ–ª–µ `sender_role` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ, –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**9. –ü—Ä–æ—á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç –∑–∞–∫–∞–∑–∞, –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–º–µ—á–∞—é—Ç—Å—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ (read_at –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°—á—ë—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è

**10. –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ö–ª–∏–∫–Ω—É—Ç—å ‚ù§Ô∏è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –†–µ–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è (–∏–ª–∏ —É–¥–∞–ª—è–µ—Ç—Å—è, –µ—Å–ª–∏ —É–∂–µ –±—ã–ª–∞)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** API `/api/messages/reactions/batch` —Ä–∞–±–æ—Ç–∞–µ—Ç, UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**11. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å attachments**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–ª–æ–∂–µ–Ω–∏–µ–º (JSON)
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ü–æ–ª–µ `attachments` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í–ª–æ–∂–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

---

### üîÑ –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø

**12. Polling –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ —á–∞—Ç–µ**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç –∑–∞–∫–∞–∑–∞, –ø–æ–¥–æ–∂–¥–∞—Ç—å 5 —Å–µ–∫—É–Ω–¥
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ù–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** `setInterval` –≤ `compact-order-chat.tsx` —Ä–∞–±–æ—Ç–∞–µ—Ç

**13. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤ –≤ –º–æ–±–∏–ª—å–Ω–æ–º —Ö–µ–¥–µ—Ä–µ**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–±–∏–ª—å–Ω—ã–π —Ö–µ–¥–µ—Ä
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –°—á—ë—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** `MobileHeaderIcons` —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `notification-read`

**14. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–æ–≤ –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω–æ–º —Ö–µ–¥–µ—Ä–µ**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–π dropdown
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –ö—Ä–∞—Å–Ω–∞—è —Ç–æ—á–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, —Å—á—ë—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** API `/api/user/counts` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

### üõ†Ô∏è API & MIGRATIONS

**15. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î**
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏: `20251228_create_notifications_table.sql`, `20251228_add_sender_role_to_messages.sql`
- **–û–∂–∏–¥–∞–Ω–∏–µ:** –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** `SELECT * FROM notifications LIMIT 1`, `DESCRIBE messages` (–µ—Å—Ç—å –ø–æ–ª–µ `sender_role`)

---

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `notifications`
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `sender_role` –≤ —Ç–∞–±–ª–∏—Ü—É `messages`
3. ‚úÖ –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ `20251225_create_missing_tables.sql`
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ `prisma/schema.prisma` - –¥–æ–±–∞–≤–ª–µ–Ω `sender_role` –≤ –º–æ–¥–µ–ª—å `messages`
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `CustomEvent('notification-read')`

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –î–û–õ–ì (–Ω–∞ –±—É–¥—É—â–µ–µ)

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - `components/shared/header-actions.tsx` (–¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ layout)
   - `app/(dashboard)/layout.tsx` (–¥–ª—è dashboard)
   - **–†–µ—à–µ–Ω–∏–µ:** –í—ã–Ω–µ—Å—Ç–∏ –≤ —Ö—É–∫ `useNotifications()` –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Realtime –ø–æ–¥–ø–∏—Å–æ–∫:**
   - –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è polling (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
   - **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–∫–ª—é—á–∏—Ç—å Supabase Realtime –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

3. **–ù–µ—Ç –ø—É—à-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - **–†–µ—à–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Web Push API –∏–ª–∏ Firebase Cloud Messaging

---

## üìù –ö–ê–ö –ó–ê–ü–£–°–ö–ê–¢–¨ –ú–ò–ì–†–ê–¶–ò–ò

```bash
# –í –ø—Ä–æ–¥–µ (Supabase Dashboard)
1. –û—Ç–∫—Ä—ã—Ç—å SQL Editor
2. –í—Å—Ç–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:
   - supabase/migrations/20251228_create_notifications_table.sql
   - supabase/migrations/20251228_add_sender_role_to_messages.sql
3. –ù–∞–∂–∞—Ç—å "Run"

# –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Supabase CLI)
supabase db push
```

---

## üß™ –ö–û–ú–ê–ù–î–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

```bash
# 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# 2. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
http://localhost:4000

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
# –ò—Å–∫–∞—Ç—å: [Prisma], [Notifications API], [Messages API]

# 4. –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Network
# –§–∏–ª—å—Ç—Ä: api/notifications, api/messages, api/user/counts

# 5. –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Console
# –ò—Å–∫–∞—Ç—å: notification-read events
```

