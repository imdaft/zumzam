# โ ะะะะะะฆะะฏ ะะ PRISMA + MANAGED POSTGRESQL ะะะะะะจะะะ

**ะะฐัะฐ:** 25 ะดะตะบะฐะฑัั 2025  
**ะกัะฐััั:** ๐ **ะฃะกะะะจะะ**

---

## ๐ ะงะขะ ะกะะะะะะ

### 1. **Managed PostgreSQL (ะฏะฝะดะตะบั.ะะฑะปะฐะบะพ)**
- โ ะะปะฐััะตั `zumzam-db` ัะพะทะดะฐะฝ
- โ PostgreSQL 16, 2 vCPU, 8 GB RAM, 50 GB SSD
- โ ะัะฑะปะธัะฝัะน ะดะพัััะฟ ะฒะบะปัััะฝ
- โ ะะฐััะธัะตะฝะธั: `postgis`, `pg_trgm`, `vector`
- โ ะะพะดะบะปััะตะฝะธะต: `rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432`

### 2. **ะะฐะฝะฝัะต ะฟะตัะตะฝะตัะตะฝั**
- โ **43 ะฟัะพัะธะปั** ะธะท ััะฐัะพะณะพ Supabase (ะกะจะ)
- โ **20 ะพัะทัะฒะพะฒ**
- โ **12 ะปะพะบะฐัะธะน**
- โ **1 ะผะฐััะตั-ะบะปะฐัั**
- โ **3 ะฐะบัะธะฒะฝะพััะธ ะฟัะพัะธะปะตะน**
- โ **7 ััะปัะณ ะฟัะพัะธะปะตะน**
- โ **2 ะฟะพะปัะทะพะฒะฐัะตะปั**

### 3. **Prisma 5.22.0 ัััะฐะฝะพะฒะปะตะฝ**
- โ ะกัะตะผะฐ ัะณะตะฝะตัะธัะพะฒะฐะฝะฐ ะธะท ะะ (20+ ะผะพะดะตะปะตะน)
- โ Prisma Client ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ
- โ ะคะฐะนะป `.env` ัะพะทะดะฐะฝ ะดะปั Prisma CLI

### 4. **ะะตะดะพััะฐััะธะต ัะฐะฑะปะธัั ัะพะทะดะฐะฝั**
- โ `ad_slots` - ัะปะพัั ะดะปั ัะตะบะปะฐะผั
- โ `advertisements` - ัะตะบะปะฐะผะฝัะต ะพะฑััะฒะปะตะฝะธั
- โ `order_requests` - ะทะฐัะฒะบะธ ะพั ะบะปะธะตะฝัะพะฒ
- โ `category_images` - ะธะทะพะฑัะฐะถะตะฝะธั ะบะฐัะตะณะพัะธะน
- โ RLS ะฟะพะปะธัะธะบะธ ะฝะฐัััะพะตะฝั
- โ ะะฐัะฐะปัะฝัะต ะดะฐะฝะฝัะต ะดะพะฑะฐะฒะปะตะฝั

### 5. **API ะฟะตัะตะฟะธัะฐะฝั ะฝะฐ Prisma**
- โ `/api/profiles/public` - ะฟะพะปััะตะฝะธะต ะฟัะพัะธะปะตะน
- โ `/api/reviews` - ะพัะทัะฒั
- โ `/api/master-class-programs` - ะผะฐััะตั-ะบะปะฐััั
- โ `/api/services` - ััะปัะณะธ
- โ `/api/agency-partners` - ะฟะฐััะฝััั ะฐะณะตะฝัััะฒ

---

## ๐ฏ ะขะะะฃะฉะะ ะกะะกะขะะฏะะะ

### โ ะะฐะฑะพัะฐะตั
- **ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ**: ะทะฐะณััะถะฐะตััั (200 OK)
- **API ะฟัะพัะธะปะตะน**: ะฒะพะทะฒัะฐัะฐะตั 39 ะฟัะพัะธะปะตะน
- **ะะฐะทะฐ ะดะฐะฝะฝัั**: Managed PostgreSQL ะฒ ะะพััะธะธ
- **ORM**: Prisma 5.22.0
- **ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ**: `npm run dev` ะฝะฐ ะฟะพััั 4000

### โ๏ธ ะะทะฒะตััะฝัะต ะฟัะพะฑะปะตะผั
1. **ะะฒัะพัะธะทะฐัะธั**: Yandex OAuth ะฝัะถะฝะพ ะฝะฐัััะพะธัั (redirect URL ะธะทะผะตะฝะธะปัั)
2. **ะััะฐะปัะฝัะต API**: ะฟะพะบะฐ ะธัะฟะพะปัะทััั Supabase client (ะฝะต ะบัะธัะธัะฝะพ, ัะฐะฑะพัะฐัั)
3. **Storage**: ัะฐะนะปั ะฟะพะบะฐ ะฝะฐ ััะฐัะพะผ Supabase (ะกะจะ)

---

## ๐ ะะะฅะะขะะะขะฃะะ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะะะะฌะะะฏ ะะะะะะะะขะะ                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  Next.js (localhost:4000)                                   โ
โ    โ                                                         โ
โ  Prisma Client 5.22.0                                       โ
โ    โ                                                         โ
โ  Managed PostgreSQL (ะฏะฝะดะตะบั.ะะฑะปะฐะบะพ)                        โ
โ    - Host: rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net       โ
โ    - Port: 6432                                             โ
โ    - DB: zumzam                                             โ
โ    - User: zumzam_admin                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง ะะะะคะะะฃะะะฆะะฏ

### `.env` (ะดะปั Prisma CLI)
```env
DATABASE_URL=postgresql://zumzam_admin:SCNK88tank33@rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432/zumzam?sslmode=require
```

### `.env.local` (ะดะปั Next.js)
```env
DATABASE_URL=postgresql://zumzam_admin:SCNK88tank33@rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432/zumzam?sslmode=require
# ... ะพััะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต
```

### `prisma/schema.prisma`
```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client"
}
```

---

## ๐ ะะะะะะะซ

### ะะฐะทัะฐะฑะพัะบะฐ
```bash
npm run dev                 # ะะฐะฟััะบ dev ัะตัะฒะตัะฐ
npx prisma studio          # ะัะบัััั Prisma Studio (GUI ะดะปั ะะ)
npx prisma db pull         # ะะฑะฝะพะฒะธัั ััะตะผั ะธะท ะะ
npx prisma generate        # ะกะณะตะฝะตัะธัะพะฒะฐัั Prisma Client
```

### ะะฐะทะฐ ะดะฐะฝะฝัั
```bash
# ะะพะดะบะปััะตะฝะธะต ัะตัะตะท psql
docker run --rm -it -e PGPASSWORD=SCNK88tank33 postgres:15 psql \
  -h rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net \
  -p 6432 \
  -U zumzam_admin \
  -d zumzam
```

---

## ๐ ะะะะฃะะฌะขะะข

- โ **152-ะคะ**: ะัะต ะดะฐะฝะฝัะต ะฒ ะะพััะธะธ
- โ **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**: Managed PostgreSQL ะฑััััะตะต ะปะพะบะฐะปัะฝะพะณะพ Docker
- โ **ะะฐัััะฐะฑะธััะตะผะพััั**: ะะพะถะฝะพ ัะฒะตะปะธัะธัั ัะตััััั ะบะปะฐััะตัะฐ ะฒ 1 ะบะปะธะบ
- โ **ะะฐะดัะถะฝะพััั**: ะะฒัะพะผะฐัะธัะตัะบะธะต ะฑัะบะฐะฟั, ัะตะฟะปะธะบะฐัะธั
- โ **ะกัะพะธะผะพััั**: ~3000โฝ/ะผะตั (ะฒะผะตััะพ 6000โฝ/ะผะตั ะทะฐ ะะ ั Docker)

---

## ๐ ะงะขะ ะะะะฌะจะ?

1. **ะะฐัััะพะธัั Yandex OAuth** (ะธะทะผะตะฝะธัั redirect URL)
2. **ะะตัะตะฝะตััะธ Storage** ะฝะฐ Yandex Object Storage (ะดะปั 152-ะคะ)
3. **ะะตัะตะฟะธัะฐัั ะพััะฐะปัะฝัะต API** ะฝะฐ Prisma (ะฝะต ะบัะธัะธัะฝะพ)
4. **ะัะพัะตััะธัะพะฒะฐัั** ัะพะทะดะฐะฝะธะต/ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฟัะพัะธะปะตะน
5. **ะะฐะดะตะฟะปะพะธัั** ะฝะฐ production ัะตัะฒะตั

---

## ๐ ะะะะขะะะขะซ

- **Managed PostgreSQL**: `rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432`
- **Yandex.Cloud Console**: https://console.yandex.cloud
- **ะะปะฐััะตั ID**: `c9qosr46a8ta5efcv2qn`
- **ะะฐัะฐะปะพะณ ID**: `b1ggfoafj4uaoth87kap`

---

**๐ ะะพะทะดัะฐะฒะปัั! ะะธะณัะฐัะธั ะทะฐะฒะตััะตะฝะฐ ััะฟะตัะฝะพ! ๐**


**ะะฐัะฐ:** 25 ะดะตะบะฐะฑัั 2025  
**ะกัะฐััั:** ๐ **ะฃะกะะะจะะ**

---

## ๐ ะงะขะ ะกะะะะะะ

### 1. **Managed PostgreSQL (ะฏะฝะดะตะบั.ะะฑะปะฐะบะพ)**
- โ ะะปะฐััะตั `zumzam-db` ัะพะทะดะฐะฝ
- โ PostgreSQL 16, 2 vCPU, 8 GB RAM, 50 GB SSD
- โ ะัะฑะปะธัะฝัะน ะดะพัััะฟ ะฒะบะปัััะฝ
- โ ะะฐััะธัะตะฝะธั: `postgis`, `pg_trgm`, `vector`
- โ ะะพะดะบะปััะตะฝะธะต: `rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432`

### 2. **ะะฐะฝะฝัะต ะฟะตัะตะฝะตัะตะฝั**
- โ **43 ะฟัะพัะธะปั** ะธะท ััะฐัะพะณะพ Supabase (ะกะจะ)
- โ **20 ะพัะทัะฒะพะฒ**
- โ **12 ะปะพะบะฐัะธะน**
- โ **1 ะผะฐััะตั-ะบะปะฐัั**
- โ **3 ะฐะบัะธะฒะฝะพััะธ ะฟัะพัะธะปะตะน**
- โ **7 ััะปัะณ ะฟัะพัะธะปะตะน**
- โ **2 ะฟะพะปัะทะพะฒะฐัะตะปั**

### 3. **Prisma 5.22.0 ัััะฐะฝะพะฒะปะตะฝ**
- โ ะกัะตะผะฐ ัะณะตะฝะตัะธัะพะฒะฐะฝะฐ ะธะท ะะ (20+ ะผะพะดะตะปะตะน)
- โ Prisma Client ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ
- โ ะคะฐะนะป `.env` ัะพะทะดะฐะฝ ะดะปั Prisma CLI

### 4. **ะะตะดะพััะฐััะธะต ัะฐะฑะปะธัั ัะพะทะดะฐะฝั**
- โ `ad_slots` - ัะปะพัั ะดะปั ัะตะบะปะฐะผั
- โ `advertisements` - ัะตะบะปะฐะผะฝัะต ะพะฑััะฒะปะตะฝะธั
- โ `order_requests` - ะทะฐัะฒะบะธ ะพั ะบะปะธะตะฝัะพะฒ
- โ `category_images` - ะธะทะพะฑัะฐะถะตะฝะธั ะบะฐัะตะณะพัะธะน
- โ RLS ะฟะพะปะธัะธะบะธ ะฝะฐัััะพะตะฝั
- โ ะะฐัะฐะปัะฝัะต ะดะฐะฝะฝัะต ะดะพะฑะฐะฒะปะตะฝั

### 5. **API ะฟะตัะตะฟะธัะฐะฝั ะฝะฐ Prisma**
- โ `/api/profiles/public` - ะฟะพะปััะตะฝะธะต ะฟัะพัะธะปะตะน
- โ `/api/reviews` - ะพัะทัะฒั
- โ `/api/master-class-programs` - ะผะฐััะตั-ะบะปะฐััั
- โ `/api/services` - ััะปัะณะธ
- โ `/api/agency-partners` - ะฟะฐััะฝััั ะฐะณะตะฝัััะฒ

---

## ๐ฏ ะขะะะฃะฉะะ ะกะะกะขะะฏะะะ

### โ ะะฐะฑะพัะฐะตั
- **ะะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ**: ะทะฐะณััะถะฐะตััั (200 OK)
- **API ะฟัะพัะธะปะตะน**: ะฒะพะทะฒัะฐัะฐะตั 39 ะฟัะพัะธะปะตะน
- **ะะฐะทะฐ ะดะฐะฝะฝัั**: Managed PostgreSQL ะฒ ะะพััะธะธ
- **ORM**: Prisma 5.22.0
- **ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ**: `npm run dev` ะฝะฐ ะฟะพััั 4000

### โ๏ธ ะะทะฒะตััะฝัะต ะฟัะพะฑะปะตะผั
1. **ะะฒัะพัะธะทะฐัะธั**: Yandex OAuth ะฝัะถะฝะพ ะฝะฐัััะพะธัั (redirect URL ะธะทะผะตะฝะธะปัั)
2. **ะััะฐะปัะฝัะต API**: ะฟะพะบะฐ ะธัะฟะพะปัะทััั Supabase client (ะฝะต ะบัะธัะธัะฝะพ, ัะฐะฑะพัะฐัั)
3. **Storage**: ัะฐะนะปั ะฟะพะบะฐ ะฝะฐ ััะฐัะพะผ Supabase (ะกะจะ)

---

## ๐ ะะะฅะะขะะะขะฃะะ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ะะะะะะฌะะะฏ ะะะะะะะะขะะ                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  Next.js (localhost:4000)                                   โ
โ    โ                                                         โ
โ  Prisma Client 5.22.0                                       โ
โ    โ                                                         โ
โ  Managed PostgreSQL (ะฏะฝะดะตะบั.ะะฑะปะฐะบะพ)                        โ
โ    - Host: rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net       โ
โ    - Port: 6432                                             โ
โ    - DB: zumzam                                             โ
โ    - User: zumzam_admin                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง ะะะะคะะะฃะะะฆะะฏ

### `.env` (ะดะปั Prisma CLI)
```env
DATABASE_URL=postgresql://zumzam_admin:SCNK88tank33@rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432/zumzam?sslmode=require
```

### `.env.local` (ะดะปั Next.js)
```env
DATABASE_URL=postgresql://zumzam_admin:SCNK88tank33@rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432/zumzam?sslmode=require
# ... ะพััะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต
```

### `prisma/schema.prisma`
```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/@prisma/client"
}
```

---

## ๐ ะะะะะะะซ

### ะะฐะทัะฐะฑะพัะบะฐ
```bash
npm run dev                 # ะะฐะฟััะบ dev ัะตัะฒะตัะฐ
npx prisma studio          # ะัะบัััั Prisma Studio (GUI ะดะปั ะะ)
npx prisma db pull         # ะะฑะฝะพะฒะธัั ััะตะผั ะธะท ะะ
npx prisma generate        # ะกะณะตะฝะตัะธัะพะฒะฐัั Prisma Client
```

### ะะฐะทะฐ ะดะฐะฝะฝัั
```bash
# ะะพะดะบะปััะตะฝะธะต ัะตัะตะท psql
docker run --rm -it -e PGPASSWORD=SCNK88tank33 postgres:15 psql \
  -h rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net \
  -p 6432 \
  -U zumzam_admin \
  -d zumzam
```

---

## ๐ ะะะะฃะะฌะขะะข

- โ **152-ะคะ**: ะัะต ะดะฐะฝะฝัะต ะฒ ะะพััะธะธ
- โ **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**: Managed PostgreSQL ะฑััััะตะต ะปะพะบะฐะปัะฝะพะณะพ Docker
- โ **ะะฐัััะฐะฑะธััะตะผะพััั**: ะะพะถะฝะพ ัะฒะตะปะธัะธัั ัะตััััั ะบะปะฐััะตัะฐ ะฒ 1 ะบะปะธะบ
- โ **ะะฐะดัะถะฝะพััั**: ะะฒัะพะผะฐัะธัะตัะบะธะต ะฑัะบะฐะฟั, ัะตะฟะปะธะบะฐัะธั
- โ **ะกัะพะธะผะพััั**: ~3000โฝ/ะผะตั (ะฒะผะตััะพ 6000โฝ/ะผะตั ะทะฐ ะะ ั Docker)

---

## ๐ ะงะขะ ะะะะฌะจะ?

1. **ะะฐัััะพะธัั Yandex OAuth** (ะธะทะผะตะฝะธัั redirect URL)
2. **ะะตัะตะฝะตััะธ Storage** ะฝะฐ Yandex Object Storage (ะดะปั 152-ะคะ)
3. **ะะตัะตะฟะธัะฐัั ะพััะฐะปัะฝัะต API** ะฝะฐ Prisma (ะฝะต ะบัะธัะธัะฝะพ)
4. **ะัะพัะตััะธัะพะฒะฐัั** ัะพะทะดะฐะฝะธะต/ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฟัะพัะธะปะตะน
5. **ะะฐะดะตะฟะปะพะธัั** ะฝะฐ production ัะตัะฒะตั

---

## ๐ ะะะะขะะะขะซ

- **Managed PostgreSQL**: `rc1b-ktk7vobktajbv2sd.mdb.yandexcloud.net:6432`
- **Yandex.Cloud Console**: https://console.yandex.cloud
- **ะะปะฐััะตั ID**: `c9qosr46a8ta5efcv2qn`
- **ะะฐัะฐะปะพะณ ID**: `b1ggfoafj4uaoth87kap`

---

**๐ ะะพะทะดัะฐะฒะปัั! ะะธะณัะฐัะธั ะทะฐะฒะตััะตะฝะฐ ััะฟะตัะฝะพ! ๐**




